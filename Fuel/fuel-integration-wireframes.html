<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AXIS 2.0 - Fuel Integration Module Wireframes</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
  </style>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            slate: {
              950: '#020617',
              900: '#0f172a',
              800: '#1e293b',
              700: '#334155',
              600: '#475569',
              500: '#64748b',
              400: '#94a3b8',
              300: '#cbd5e1',
              200: '#e2e8f0',
              100: '#f1f5f9',
            }
          }
        }
      }
    }
  </script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
// Lucide icon components
const { useState } = React;

// Create icon components from Lucide
const createIcon = (name) => {
  return function IconComponent({ className = "", size = 24 }) {
    const ref = React.useRef(null);
    React.useEffect(() => {
      if (ref.current) {
        ref.current.innerHTML = '';
        const icon = lucide.createElement(lucide.icons[name]);
        icon.setAttribute('class', className);
        icon.setAttribute('width', size);
        icon.setAttribute('height', size);
        ref.current.appendChild(icon);
      }
    }, [className, size]);
    return React.createElement('span', { ref, className: 'inline-flex items-center justify-center' });
  };
};

const Fuel = createIcon('Fuel');
const CreditCard = createIcon('CreditCard');
const Users = createIcon('Users');
const TrendingUp = createIcon('TrendingUp');
const Settings = createIcon('Settings');
const MapPin = createIcon('MapPin');
const Truck = createIcon('Truck');
const DollarSign = createIcon('DollarSign');
const Shield = createIcon('Shield');
const BarChart3 = createIcon('BarChart3');
const ChevronRight = createIcon('ChevronRight');
const ChevronDown = createIcon('ChevronDown');
const Bell = createIcon('Bell');
const Search = createIcon('Search');
const Plus = createIcon('Plus');
const Edit2 = createIcon('Edit2');
const Eye = createIcon('Eye');
const EyeOff = createIcon('EyeOff');
const ToggleLeft = createIcon('ToggleLeft');
const ToggleRight = createIcon('ToggleRight');
const Navigation = createIcon('Navigation');
const Clock = createIcon('Clock');
const AlertTriangle = createIcon('AlertTriangle');
const CheckCircle = createIcon('CheckCircle');
const XCircle = createIcon('XCircle');
const Smartphone = createIcon('Smartphone');
const Building2 = createIcon('Building2');
const UserCircle = createIcon('UserCircle');
const Gauge = createIcon('Gauge');
const Target = createIcon('Target');
const Zap = createIcon('Zap');
const Filter = createIcon('Filter');
const Download = createIcon('Download');
const RefreshCw = createIcon('RefreshCw');
const ArrowRight = createIcon('ArrowRight');
const ArrowDown = createIcon('ArrowDown');
const Info = createIcon('Info');
const ExternalLink = createIcon('ExternalLink');
const Play = createIcon('Play');
const Pause = createIcon('Pause');
const RotateCcw = createIcon('RotateCcw');
const Car = createIcon('Car');
const Activity = createIcon('Activity');
const Calendar = createIcon('Calendar');
const FileText = createIcon('FileText');
const Lock = createIcon('Lock');
const Unlock = createIcon('Unlock');
const X = createIcon('X');

// AXIS 2.0 Fuel Integration Module - Interactive Wireframes
function FuelIntegrationWireframes() {
  const [activeView, setActiveView] = useState('admin-dashboard');
  const [activePlatform, setActivePlatform] = useState('all');
  const [showPricingModal, setShowPricingModal] = useState(false);
  const [showCardModal, setShowCardModal] = useState(false);
  const [expandedCard, setExpandedCard] = useState(null);
  const [driverView, setDriverView] = useState('fuel-stops');

  const views = [
    { id: 'admin-dashboard', label: 'Admin Dashboard', icon: BarChart3 },
    { id: 'process-flows', label: 'Process Flows', icon: Zap },
    { id: 'supplier-discounts', label: 'Supplier Discounts', icon: DollarSign },
    { id: 'pricing-models', label: 'Pricing Models', icon: TrendingUp },
    { id: 'card-management', label: 'Card Management', icon: CreditCard },
    { id: 'franchise-admin', label: 'Franchise Admin', icon: Building2 },
    { id: 'driver-app', label: 'Driver App', icon: Smartphone },
    { id: 'fuel-optimizer', label: 'Fuel Optimizer', icon: MapPin },
    { id: 'reports', label: 'Reports & IFTA', icon: BarChart3 },
    { id: 'settings', label: 'Settings', icon: Settings },
  ];

  return (
    <div className="min-h-screen bg-slate-950 text-slate-100 font-sans">
      {/* Top Header */}
      <header className="bg-slate-900 border-b border-slate-800 px-6 py-3 flex items-center justify-between sticky top-0 z-50">
        <div className="flex items-center gap-4">
          <div className="flex items-center gap-2">
            <div className="w-8 h-8 bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg flex items-center justify-center">
              <Zap className="w-5 h-5 text-white" />
            </div>
            <span className="text-xl font-bold tracking-tight">AXIS</span>
            <span className="text-xs bg-amber-500/20 text-amber-400 px-2 py-0.5 rounded-full font-medium">2.0</span>
          </div>
          <div className="h-6 w-px bg-slate-700" />
          <span className="text-slate-400 font-medium">Fuel Integration Module</span>
        </div>
        <div className="flex items-center gap-4">
          <span className="text-xs text-slate-500 bg-slate-800 px-3 py-1.5 rounded-full">WIREFRAME PREVIEW</span>
          <Bell className="w-5 h-5 text-slate-400" />
          <div className="w-8 h-8 bg-slate-700 rounded-full flex items-center justify-center text-sm font-medium">EA</div>
        </div>
      </header>

      <div className="flex">
        {/* Sidebar Navigation */}
        <aside className="w-64 bg-slate-900/50 border-r border-slate-800 min-h-[calc(100vh-57px)] sticky top-[57px] self-start">
          <nav className="p-4 space-y-1">
            {views.map((view) => (
              <button
                key={view.id}
                onClick={() => setActiveView(view.id)}
                className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left transition-all ${
                  activeView === view.id
                    ? 'bg-amber-500/10 text-amber-400 border border-amber-500/20'
                    : 'text-slate-400 hover:bg-slate-800 hover:text-slate-200'
                }`}
              >
                <view.icon className="w-4 h-4" />
                <span className="text-sm font-medium">{view.label}</span>
              </button>
            ))}
          </nav>
          
          {/* Platform Filter */}
          <div className="p-4 border-t border-slate-800">
            <p className="text-xs text-slate-500 uppercase tracking-wider mb-3">Platforms</p>
            <div className="space-y-1">
              {['all', 'EFS', 'Commdata', 'Relay'].map((platform) => (
                <button
                  key={platform}
                  onClick={() => setActivePlatform(platform)}
                  className={`w-full flex items-center gap-2 px-3 py-2 rounded text-left text-sm ${
                    activePlatform === platform
                      ? 'bg-slate-800 text-slate-200'
                      : 'text-slate-500 hover:text-slate-300'
                  }`}
                >
                  <div className={`w-2 h-2 rounded-full ${
                    platform === 'all' ? 'bg-slate-400' :
                    platform === 'EFS' ? 'bg-blue-500' :
                    platform === 'Commdata' ? 'bg-green-500' : 'bg-purple-500'
                  }`} />
                  {platform === 'all' ? 'All Platforms' : platform}
                </button>
              ))}
            </div>
          </div>
        </aside>

        {/* Main Content */}
        <main className="flex-1 p-6">
          {activeView === 'admin-dashboard' && <AdminDashboard />}
          {activeView === 'process-flows' && <ProcessFlows />}
          {activeView === 'supplier-discounts' && <SupplierDiscounts />}
          {activeView === 'pricing-models' && <PricingModels showModal={showPricingModal} setShowModal={setShowPricingModal} />}
          {activeView === 'card-management' && <CardManagement showModal={showCardModal} setShowModal={setShowCardModal} expandedCard={expandedCard} setExpandedCard={setExpandedCard} />}
          {activeView === 'franchise-admin' && <FranchiseAdmin />}
          {activeView === 'driver-app' && <DriverApp driverView={driverView} setDriverView={setDriverView} />}
          {activeView === 'fuel-optimizer' && <FuelOptimizer />}
          {activeView === 'reports' && <Reports />}
          {activeView === 'settings' && <SettingsView />}
        </main>
      </div>
    </div>
  );
}

// ============ ADMIN DASHBOARD ============
function AdminDashboard() {
  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold">Fuel Program Dashboard</h1>
          <p className="text-slate-400 mt-1">Real-time overview across all platforms</p>
        </div>
        <div className="flex items-center gap-3">
          <button className="flex items-center gap-2 px-4 py-2 bg-slate-800 rounded-lg text-sm hover:bg-slate-700 transition">
            <RefreshCw className="w-4 h-4" />
            Sync Now
          </button>
          <button className="flex items-center gap-2 px-4 py-2 bg-amber-500 text-slate-900 rounded-lg text-sm font-medium hover:bg-amber-400 transition">
            <Download className="w-4 h-4" />
            Export
          </button>
        </div>
      </div>

      {/* KPI Cards */}
      <div className="grid grid-cols-4 gap-4">
        <KPICard 
          title="Total Fuel Spend" 
          value="$847,293" 
          change="+12.3%" 
          period="This Month"
          icon={Fuel}
          color="amber"
        />
        <KPICard 
          title="Discount Captured" 
          value="$94,218" 
          change="+8.7%" 
          period="vs. Pump Price"
          icon={DollarSign}
          color="green"
        />
        <KPICard 
          title="Active Cards" 
          value="412" 
          change="+24" 
          period="This Week"
          icon={CreditCard}
          color="blue"
        />
        <KPICard 
          title="Avg Fleet MPG" 
          value="6.8" 
          change="+0.3" 
          period="vs. Last Month"
          icon={Gauge}
          color="purple"
        />
      </div>

      {/* Platform Status */}
      <div className="grid grid-cols-3 gap-4">
        <PlatformCard name="EFS" status="connected" lastSync="2 min ago" cards={245} spend="$412,847" />
        <PlatformCard name="Commdata" status="connected" lastSync="5 min ago" cards={134} spend="$298,122" />
        <PlatformCard name="Relay" status="connected" lastSync="1 min ago" cards={33} spend="$136,324" />
      </div>

      {/* Charts Row */}
      <div className="grid grid-cols-2 gap-6">
        {/* Spend by Entity Type */}
        <div className="bg-slate-900 rounded-xl p-6 border border-slate-800">
          <h3 className="font-semibold mb-4">Spend by Entity Type</h3>
          <div className="space-y-4">
            <SpendBar label="Company Drivers" amount="$412,847" percent={48} color="bg-amber-500" />
            <SpendBar label="Owner-Operators" amount="$234,122" percent={28} color="bg-blue-500" />
            <SpendBar label="Franchises" amount="$156,234" percent={18} color="bg-green-500" />
            <SpendBar label="Carriers (Brokerage)" amount="$44,090" percent={6} color="bg-purple-500" />
          </div>
        </div>

        {/* Margin Analysis */}
        <div className="bg-slate-900 rounded-xl p-6 border border-slate-800">
          <h3 className="font-semibold mb-4">Margin Analysis (Hidden from Drivers)</h3>
          <div className="grid grid-cols-2 gap-4 mb-4">
            <div className="bg-slate-800/50 rounded-lg p-4">
              <p className="text-xs text-slate-500 uppercase tracking-wider">Our Cost</p>
              <p className="text-2xl font-bold text-slate-100 mt-1">$753,075</p>
            </div>
            <div className="bg-slate-800/50 rounded-lg p-4">
              <p className="text-xs text-slate-500 uppercase tracking-wider">Billed to Entities</p>
              <p className="text-2xl font-bold text-green-400 mt-1">$847,293</p>
            </div>
          </div>
          <div className="bg-green-500/10 border border-green-500/20 rounded-lg p-4">
            <div className="flex items-center justify-between">
              <span className="text-green-400 font-medium">Fuel Program Revenue</span>
              <span className="text-2xl font-bold text-green-400">$94,218</span>
            </div>
            <p className="text-xs text-slate-500 mt-1">11.1% average margin across all entities</p>
          </div>
        </div>
      </div>

      {/* Recent Transactions */}
      <div className="bg-slate-900 rounded-xl border border-slate-800">
        <div className="p-4 border-b border-slate-800 flex items-center justify-between">
          <h3 className="font-semibold">Recent Transactions</h3>
          <button className="text-sm text-amber-400 hover:text-amber-300">View All →</button>
        </div>
        <div className="divide-y divide-slate-800">
          <TransactionRow 
            driver="Miguel Rodriguez" 
            truck="T-2847" 
            location="Pilot #4521 - Dallas, TX"
            gallons={127}
            pumpPrice={3.42}
            driverPrice={3.28}
            time="12 min ago"
            platform="EFS"
          />
          <TransactionRow 
            driver="James Wilson" 
            truck="T-1923" 
            location="Love's #847 - Phoenix, AZ"
            gallons={98}
            pumpPrice={3.56}
            driverPrice={3.41}
            time="28 min ago"
            platform="Commdata"
          />
          <TransactionRow 
            driver="Sarah Chen" 
            truck="T-3012" 
            location="TA #192 - Memphis, TN"
            gallons={142}
            pumpPrice={3.38}
            driverPrice={3.24}
            time="45 min ago"
            platform="EFS"
          />
        </div>
      </div>

      {/* Alerts & Fraud Detection */}
      <div className="bg-slate-900 rounded-xl border border-slate-800">
        <div className="p-4 border-b border-slate-800">
          <h3 className="font-semibold">Alerts & Anomalies</h3>
        </div>
        <div className="p-4 space-y-3">
          <AlertRow 
            type="warning"
            message="Out-of-route purchase detected: Driver #2847 fueled 47 miles off assigned route"
            time="2 hours ago"
          />
          <AlertRow 
            type="info"
            message="Card #EFS-4521 approaching daily limit ($412 of $500)"
            time="3 hours ago"
          />
          <AlertRow 
            type="success"
            message="Driver Maria Santos promoted to Gold tier - pricing updated automatically"
            time="Yesterday"
          />
        </div>
      </div>
    </div>
  );
}

// ============ PROCESS FLOWS ============
function ProcessFlows() {
  const [activeFlow, setActiveFlow] = useState('card-provisioning');
  const [selectedStep, setSelectedStep] = useState(null);
  
  const flows = [
    { id: 'card-provisioning', label: 'Card Provisioning', icon: CreditCard },
    { id: 'fuel-transaction', label: 'Fuel Transaction', icon: Fuel },
    { id: 'pricing-calculation', label: 'Pricing Calculation', icon: DollarSign },
    { id: 'fuel-recommendation', label: 'Fuel Stop Recommendation', icon: MapPin },
    { id: 'settlement-billing', label: 'Settlement & Billing', icon: TrendingUp },
    { id: 'card-suspension', label: 'Card Suspension', icon: Shield },
    { id: 'franchise-pricing', label: 'Franchise Pricing', icon: Building2 },
    { id: 'tier-recalculation', label: 'Tier Recalculation', icon: Target },
  ];

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold">Process Flows</h1>
        <p className="text-slate-400 mt-1">Understand the order of events and system processes</p>
      </div>

      {/* Flow Selection */}
      <div className="flex flex-wrap gap-2">
        {flows.map((flow) => (
          <button
            key={flow.id}
            onClick={() => setActiveFlow(flow.id)}
            className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition ${
              activeFlow === flow.id
                ? 'bg-amber-500 text-slate-900'
                : 'bg-slate-800 text-slate-400 hover:bg-slate-700'
            }`}
          >
            <flow.icon className="w-4 h-4" />
            {flow.label}
          </button>
        ))}
      </div>

      {/* Flow Diagrams */}
      {activeFlow === 'card-provisioning' && <CardProvisioningFlow onStepClick={setSelectedStep} />}
      {activeFlow === 'fuel-transaction' && <FuelTransactionFlow onStepClick={setSelectedStep} />}
      {activeFlow === 'pricing-calculation' && <PricingCalculationFlow onStepClick={setSelectedStep} />}
      {activeFlow === 'fuel-recommendation' && <FuelRecommendationFlow onStepClick={setSelectedStep} />}
      {activeFlow === 'settlement-billing' && <SettlementBillingFlow onStepClick={setSelectedStep} />}
      {activeFlow === 'card-suspension' && <CardSuspensionFlow onStepClick={setSelectedStep} />}
      {activeFlow === 'franchise-pricing' && <FranchisePricingFlow onStepClick={setSelectedStep} />}
      {activeFlow === 'tier-recalculation' && <TierRecalculationFlow onStepClick={setSelectedStep} />}

      {/* Step Detail Modal */}
      {selectedStep && (
        <StepDetailModal step={selectedStep} onClose={() => setSelectedStep(null)} />
      )}
    </div>
  );
}

function CardProvisioningFlow({ onStepClick }) {
  return (
    <div className="space-y-6">
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <div className="flex items-center gap-3 mb-6">
          <div className="w-10 h-10 bg-amber-500/20 rounded-lg flex items-center justify-center">
            <CreditCard className="w-5 h-5 text-amber-400" />
          </div>
          <div>
            <h3 className="font-semibold">Card Provisioning Flow</h3>
            <p className="text-sm text-slate-500">From driver onboarding to card activation • Click any step for details</p>
          </div>
        </div>

        {/* Flow Diagram */}
        <div className="relative">
          {/* Vertical Flow */}
          <div className="space-y-4">
            <FlowStep 
              step={1}
              title="Driver Begins Onboarding"
              description="New driver enters AXIS onboarding workflow"
              actor="Driver / Recruiting"
              system="AXIS Onboarding Module"
              timing="Day 0"
              color="blue"
              onStepClick={onStepClick}
              extendedDescription="The onboarding process begins when a new driver is added to the AXIS system by the recruiting team. This creates a driver profile and initiates the automated onboarding workflow that will guide the driver through all required steps before they can begin driving."
              technicalNotes="Driver record created in AXIS Core database. Onboarding workflow triggered via event-driven architecture. Webhook notifications sent to relevant departments."
              integrations={["AXIS Onboarding Module", "HR System", "Background Check API", "Drug Testing Portal"]}
              successCriteria="Driver profile created with unique ID, onboarding workflow initiated, welcome email sent to driver"
            />
            <FlowConnector />
            <FlowStep 
              step={2}
              title="Onboarding Steps Completed"
              description="Driver completes required documentation, training, drug test, background check"
              actor="Driver"
              system="AXIS Onboarding Module"
              timing="Day 1-5"
              color="blue"
              onStepClick={onStepClick}
              extendedDescription="The driver must complete all mandatory onboarding requirements including document uploads (CDL, medical card, etc.), safety training modules, drug screening, and background verification. The system tracks completion status in real-time and prevents progression until all requirements are met."
              technicalNotes="Each requirement has a completion flag in the database. Background check and drug test results are received via API callbacks from third-party providers. Training completion tracked via LMS integration."
              integrations={["Document Management System", "LMS Training Platform", "Drug Test Provider API", "Background Check API"]}
              errorHandling="If drug test fails or background check returns disqualifying results, onboarding is halted and card provisioning is blocked. HR is notified for manual review."
              successCriteria="All onboarding checkboxes marked complete, no blocking issues flagged, driver status updated to 'Onboarding Complete'"
            />
            <FlowConnector />
            <FlowStep 
              step={3}
              title="System Determines Entity Type"
              description="AXIS identifies driver type: Company Driver, Owner-Operator, Franchise Driver, or Carrier"
              actor="System (Automatic)"
              system="AXIS Core"
              timing="Immediate"
              color="purple"
              onStepClick={onStepClick}
              details={[
                "Company Driver → Routes to EFS",
                "Owner-Operator → Routes to EFS",
                "Franchise Driver → Routes to Commdata",
                "Carrier (Brokerage) → Routes to Relay"
              ]}
              extendedDescription="Based on the driver's employment classification set during profile creation, the system automatically determines which fuel card platform to use. This routing logic is configurable but follows standard business rules that align card platforms with entity types for optimal discount capture and billing workflows."
              technicalNotes="Entity type stored in driver_profiles.entity_type field. Routing rules defined in fuel_platform_routing configuration table. Rules can be overridden at the individual driver level if needed."
              integrations={["AXIS Core Database", "Fuel Platform Routing Engine"]}
              successCriteria="Entity type correctly identified, appropriate fuel platform selected for provisioning"
            />
            <FlowConnector />
            <FlowStep 
              step={4}
              title="Platform Selection & Card Request"
              description="System selects appropriate fuel platform and sends API request to provision card"
              actor="System (Automatic)"
              system="Fuel Integration Module"
              timing="Immediate"
              color="purple"
              onStepClick={onStepClick}
              details={[
                "API call to EFS/Commdata/Relay",
                "Includes driver info, entity type, assigned truck"
              ]}
              extendedDescription="The Fuel Integration Module constructs an API request to the selected platform (EFS, Commdata, or Relay) containing all necessary driver and vehicle information. This request initiates the card creation process on the platform side."
              technicalNotes="API request includes: driver_id, first_name, last_name, truck_number, entity_type, terminal_id (for shipping), default_controls object. Request is logged for audit trail. Retry logic with exponential backoff for failed requests."
              integrations={["EFS API", "Commdata API", "Relay API"]}
              errorHandling="If API call fails, system retries up to 3 times with exponential backoff. After 3 failures, alert is sent to admin and card is queued for manual provisioning."
              successCriteria="API returns 200 OK with card_provisioning_id, request logged in fuel_card_requests table"
            />
            <FlowConnector />
            <FlowStep 
              step={5}
              title="Pricing Model Assignment"
              description="System assigns default pricing model based on entity type"
              actor="System (Automatic)"
              system="Fuel Integration Module"
              timing="Immediate"
              color="purple"
              onStepClick={onStepClick}
              details={[
                "Company Driver → Tiered by Score (starts Bronze)",
                "Owner-Operator → O/O Standard Rate",
                "Franchise Driver → Franchise's assigned rate",
                "Carrier → Carrier Fuel Advance rate"
              ]}
              extendedDescription="Every new card must have a pricing model assigned that determines how the driver will be charged for fuel. New company drivers start at Bronze tier until they accumulate enough performance history to be evaluated for higher tiers. Owner-operators and carriers receive their respective standard rates."
              technicalNotes="Pricing model assignment stored in fuel_cards.pricing_model_id. For tiered pricing, new drivers default to lowest tier (Bronze) with pricing_tier='bronze'. First tier evaluation occurs after 30 days of activity."
              integrations={["Pricing Models Database", "Driver Score Engine"]}
              successCriteria="Pricing model ID linked to card record, initial tier set for tiered models"
            />
            <FlowConnector />
            <FlowStep 
              step={6}
              title="Default Controls Applied"
              description="System applies default card controls"
              actor="System (Automatic)"
              system="Fuel Integration Module"
              timing="Immediate"
              color="purple"
              onStepClick={onStepClick}
              details={[
                "Daily Limit: $500",
                "Transaction Limit: $300",
                "Gallon Limit: 150/day",
                "Products: Diesel, DEF, Reefer",
                "Network: In-Network Only"
              ]}
              extendedDescription="Default card controls are applied to ensure appropriate spending limits and product restrictions. These controls can be customized per driver by an administrator after card activation, but starting with conservative defaults protects against misuse."
              technicalNotes="Default controls pulled from fuel_settings.default_card_controls JSON. Controls sent to platform API as part of card configuration. Controls can be updated in real-time via platform API after card is active."
              integrations={["Fuel Platform APIs", "Settings Configuration"]}
              successCriteria="All control parameters set on card record and synced to fuel platform"
            />
            <FlowConnector />
            <FlowStep 
              step={7}
              title="Card Provisioned in Platform"
              description="Fuel platform confirms card created, returns card number"
              actor="External Platform"
              system="EFS / Commdata / Relay"
              timing="< 1 minute"
              color="green"
              onStepClick={onStepClick}
              extendedDescription="The fuel platform processes the provisioning request and creates the card in their system. Upon successful creation, they return a unique card number and confirmation. This card number is stored in AXIS and linked to the driver profile."
              technicalNotes="Platform webhook callback received with card_number, status='provisioned', expiration_date. Card record updated in fuel_cards table. Card status set to 'provisioned' (not yet 'active' until first use)."
              integrations={["Platform Webhook Handler", "Fuel Cards Database"]}
              errorHandling="If platform returns error, card request is flagged for manual review. Common errors: duplicate driver, invalid truck number, platform system unavailable."
              successCriteria="Card number received and stored, card status set to 'provisioned', driver notified"
            />
            <FlowConnector />
            <FlowStep 
              step={8}
              title="Physical Card Ships"
              description="Platform ships physical card to driver's assigned terminal"
              actor="External Platform"
              system="EFS / Commdata / Relay"
              timing="3-5 business days"
              color="green"
              onStepClick={onStepClick}
              extendedDescription="The fuel platform prints and ships the physical fuel card to the terminal address associated with the driver's profile. The terminal is responsible for holding the card until the driver picks it up in person."
              technicalNotes="Shipping address pulled from driver_profiles.terminal_id → terminals.address. Tracking number (if provided by platform) stored in fuel_cards.shipping_tracking. Email notification sent to terminal manager when card ships."
              integrations={["Terminal Management System", "Notification Service"]}
              successCriteria="Card shipped, tracking number logged (if available), terminal notified of incoming card"
            />
            <FlowConnector />
            <FlowStep 
              step={9}
              title="Driver Picks Up Card"
              description="Driver retrieves card from terminal, card activates on first use"
              actor="Driver"
              system="Terminal Location"
              timing="Day 5-10"
              color="amber"
              onStepClick={onStepClick}
              extendedDescription="The driver visits their assigned terminal to pick up the physical fuel card. Terminal staff may verify driver identity before handing over the card. The card automatically activates upon first successful transaction at a fuel station."
              technicalNotes="Card pickup can optionally be logged in AXIS via terminal staff interface. Card status automatically changes from 'provisioned' to 'active' when first transaction is received from fuel platform."
              integrations={["Terminal Staff Interface (optional)", "Transaction Sync Service"]}
              successCriteria="Driver has physical card in hand, ready for first fuel purchase"
            />
            <FlowConnector />
            <FlowStep 
              step={10}
              title="Card Active & Monitoring Begins"
              description="Card is fully active, transactions sync to AXIS, fraud monitoring enabled"
              actor="System (Automatic)"
              system="Fuel Integration Module"
              timing="Ongoing"
              color="green"
              onStepClick={onStepClick}
              isLast
              extendedDescription="Once the card is active, all transactions are synced to AXIS every 15 minutes. The fraud detection system monitors for anomalies such as out-of-route purchases, unusual volumes, and velocity violations. The driver's fuel activity contributes to their performance score."
              technicalNotes="Transaction sync runs every 15 minutes via scheduled job. Fraud detection rules evaluated on each new transaction. MPG calculations updated after each fuel purchase. Data feeds into driver score calculation (weekly)."
              integrations={["Transaction Sync Service", "Fraud Detection Engine", "Driver Score Engine", "Settlement Module"]}
              successCriteria="Transactions flowing into AXIS, no fraud alerts on normal usage, data available for reporting"
            />
          </div>
        </div>
      </div>

      {/* Key Decision Points */}
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <h4 className="font-semibold mb-4">Key Decision Points</h4>
        <div className="grid grid-cols-3 gap-4">
          <DecisionPoint 
            title="Platform Routing"
            condition="Based on Entity Type"
            outcomes={[
              "Company/O-O → EFS",
              "Franchise → Commdata",
              "Carrier → Relay"
            ]}
          />
          <DecisionPoint 
            title="Pricing Model"
            condition="Based on Entity Type"
            outcomes={[
              "Company → Tiered (Score-based)",
              "O-O → Standard Rate",
              "Franchise → Franchise Ceiling"
            ]}
          />
          <DecisionPoint 
            title="Ship Destination"
            condition="Always"
            outcomes={[
              "Driver's Terminal (configured)",
              "Terminal lookup from driver profile"
            ]}
          />
        </div>
      </div>
    </div>
  );
}

function FuelTransactionFlow({ onStepClick }) {
  return (
    <div className="space-y-6">
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <div className="flex items-center gap-3 mb-6">
          <div className="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center">
            <Fuel className="w-5 h-5 text-green-400" />
          </div>
          <div>
            <h3 className="font-semibold">Fuel Transaction Flow</h3>
            <p className="text-sm text-slate-500">From pump to settlement deduction • Click any step for details</p>
          </div>
        </div>

        <div className="space-y-4">
          <FlowStep 
            step={1}
            title="Driver Arrives at Fuel Station"
            description="Driver selects in-network fuel station (ideally from AXIS recommendation)"
            actor="Driver"
            system="Physical Location"
            timing="Real-time"
            color="blue"
            onStepClick={onStepClick}
            extendedDescription="The driver arrives at a fuel station, ideally one recommended by the AXIS fuel optimizer. In-network stations provide better discounts and ensure full transaction data is captured. The driver should verify the station accepts their card type (EFS, Commdata, or Relay)."
            technicalNotes="AXIS recommendations prioritize in-network stations. Out-of-network transactions may still be authorized but at reduced or no discount, and will trigger monitoring alerts if significantly off-route."
            integrations={["Driver App", "Fuel Stop Optimizer"]}
            successCriteria="Driver at an in-network fuel station with active fuel card ready"
          />
          <FlowConnector />
          <FlowStep 
            step={2}
            title="Card Swipe & Authorization Request"
            description="Driver swipes fuel card at pump, enters driver ID and odometer reading"
            actor="Driver"
            system="Fuel Station POS"
            timing="Real-time"
            color="blue"
            onStepClick={onStepClick}
            extendedDescription="At the pump, the driver swipes or inserts their fuel card. Most fuel platforms require entering a driver ID (PIN or employee number) and current odometer reading. The odometer helps track fuel efficiency and detect fraudulent transactions."
            technicalNotes="Driver ID verification happens at platform level. Odometer reading stored with transaction and used for MPG calculations. Some stations support contactless payment which skips PIN entry."
            integrations={["Fuel Station POS", "Platform Authorization System"]}
            errorHandling="If driver ID is rejected, driver should contact dispatch. If odometer seems wrong (too low since last fill), some systems will flag for review but still authorize."
            successCriteria="Card accepted by pump, driver ID verified, odometer recorded"
          />
          <FlowConnector />
          <FlowStep 
            step={3}
            title="Platform Authorization Check"
            description="Fuel platform validates: card status, daily limits, product restrictions, network"
            actor="System (Automatic)"
            system="EFS / Commdata / Relay"
            timing="< 3 seconds"
            color="purple"
            onStepClick={onStepClick}
            details={[
              "Is card active? → Proceed / Decline",
              "Within daily limit? → Proceed / Decline",
              "Approved product? → Proceed / Decline",
              "In-network location? → Proceed / Decline"
            ]}
            extendedDescription="The fuel platform performs real-time validation against the card's configured controls. This includes checking if the card is active, whether the transaction would exceed daily spending or gallon limits, if the requested product (diesel, DEF, etc.) is allowed, and if the station is within the approved network."
            technicalNotes="Authorization response includes: auth_code, remaining_daily_limit, approved_products array. Pre-authorization amount is typically $150-300 depending on platform settings."
            integrations={["Platform Authorization API", "Card Controls Database"]}
            errorHandling="Declined transactions return error codes: CARD_INACTIVE, LIMIT_EXCEEDED, PRODUCT_RESTRICTED, OUT_OF_NETWORK. Driver sees generic 'See Cashier' message at pump."
            successCriteria="Authorization approved with auth_code, transaction can proceed"
          />
          <FlowConnector />
          <FlowStep 
            step={4}
            title="Fueling Authorized"
            description="Pump releases fuel, driver fills tank"
            actor="Driver"
            system="Fuel Station"
            timing="5-15 minutes"
            color="green"
            onStepClick={onStepClick}
            extendedDescription="Upon successful authorization, the pump releases and the driver can begin fueling. The driver should fill to their needs but be mindful of any gallon limits on their card. The pump automatically stops if pre-auth limit is reached."
            technicalNotes="Pre-authorization holds funds on the card during fueling. Actual amount is captured when pump handle is returned. Some drivers may need to run multiple transactions if tank capacity exceeds pre-auth amount."
            successCriteria="Driver successfully dispenses fuel into vehicle tank"
          />
          <FlowConnector />
          <FlowStep 
            step={5}
            title="Transaction Completed at Pump"
            description="Final gallons and pump price recorded by station"
            actor="System"
            system="Fuel Station POS"
            timing="Immediate"
            color="green"
            onStepClick={onStepClick}
            extendedDescription="When the driver finishes fueling and returns the pump handle, the station POS records the final transaction details including exact gallons dispensed, pump price per gallon, and total amount. A receipt is typically available."
            technicalNotes="Transaction timestamp recorded to the second. Pump price is the retail price displayed at the station (before any card discounts). Some stations split DEF and diesel into separate line items automatically."
            successCriteria="Transaction finalized with accurate gallon count and pricing"
          />
          <FlowConnector />
          <FlowStep 
            step={6}
            title="Transaction Data Sent to Platform"
            description="Station transmits transaction details to fuel card platform"
            actor="System"
            system="EFS / Commdata / Relay"
            timing="< 5 minutes"
            color="purple"
            onStepClick={onStepClick}
            extendedDescription="The fuel station's point-of-sale system transmits the completed transaction to the fuel card platform's processing center. This includes all captured data: card number, transaction ID, timestamp, location, gallons, products, and amounts."
            technicalNotes="Transmission uses secure EDI or API protocols. Large chains batch transmit frequently; smaller stations may batch hourly. Platform applies negotiated discounts at this stage."
            integrations={["Station EDI/API", "Platform Processing System"]}
            errorHandling="Transmission failures are queued and retried. Transactions may appear delayed in AXIS if station transmission is slow."
            successCriteria="Transaction received and logged by fuel platform"
          />
          <FlowConnector />
          <FlowStep 
            step={7}
            title="AXIS Syncs Transaction"
            description="AXIS pulls transaction via API (every 15 minutes)"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Within 15 minutes"
            color="purple"
            onStepClick={onStepClick}
            details={[
              "Pulls: timestamp, location, gallons, pump price, product type, odometer, card ID"
            ]}
            extendedDescription="AXIS runs a scheduled job every 15 minutes that queries each fuel platform's API for new transactions. The sync pulls all transaction fields needed for pricing calculation, reporting, and fraud detection."
            technicalNotes="Sync job uses cursor-based pagination to handle high volumes. Transactions are deduplicated using platform_transaction_id. Failed syncs are retried on next cycle with alerts after 3 consecutive failures."
            integrations={["EFS Transaction API", "Commdata Transaction API", "Relay Transaction API", "AXIS Transaction Database"]}
            errorHandling="If API is unavailable, transactions queue on platform side. AXIS catches up on next successful sync. No data loss occurs."
            successCriteria="Transaction record created in AXIS with all required fields populated"
          />
          <FlowConnector />
          <FlowStep 
            step={8}
            title="Pricing Calculation"
            description="AXIS calculates three price points for this transaction"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="amber"
            onStepClick={onStepClick}
            details={[
              "1. Our Cost = Pump price - Supplier discount",
              "2. Driver Price = Based on assigned pricing model",
              "3. Margin = Driver Price - Our Cost"
            ]}
            extendedDescription="This is the core pricing engine step. AXIS calculates three distinct price points: (1) Our Cost - what Mega actually pays after supplier discounts, (2) Driver Price - what the driver/entity will be charged based on their pricing model, and (3) Margin - the difference that represents fuel program revenue."
            technicalNotes="Pricing calculation is deterministic and auditable. All inputs (pump price, discount rules, pricing model params) are versioned. Calculation stored with transaction for historical accuracy even if rules change later."
            integrations={["Supplier Discount Engine", "Pricing Model Engine"]}
            successCriteria="All three price points calculated and stored: our_cost_per_gallon, driver_price_per_gallon, margin_per_gallon"
          />
          <FlowConnector />
          <FlowStep 
            step={9}
            title="Fraud Analysis"
            description="System checks for anomalies"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="purple"
            onStepClick={onStepClick}
            details={[
              "Out-of-route purchase?",
              "Unusual volume for truck type?",
              "Velocity check (multiple transactions)",
              "Flag if anomaly detected"
            ]}
            extendedDescription="Every transaction passes through the fraud detection engine which evaluates multiple risk factors. Anomalies don't automatically block transactions (they're already complete) but generate alerts for review and may trigger card controls adjustment."
            technicalNotes="Fraud rules are configurable per entity type. Out-of-route detection compares transaction lat/long to active dispatch route with configurable buffer (default 25 miles). Velocity checks look for multiple transactions within 2 hours."
            integrations={["Dispatch Module (route data)", "Telematics (location verification)", "Alert System"]}
            errorHandling="High-severity fraud flags can trigger automatic card suspension. Medium flags create alerts. Low flags are logged for pattern analysis."
            successCriteria="Transaction scored for fraud risk, appropriate alerts generated if warranted"
          />
          <FlowConnector />
          <FlowStep 
            step={10}
            title="Transaction Logged for Settlement"
            description="Transaction queued for next settlement/payroll cycle"
            actor="System (Automatic)"
            system="Settlement Module"
            timing="Batched"
            color="green"
            onStepClick={onStepClick}
            isLast
            extendedDescription="The fully processed transaction is now queued for settlement. Depending on entity type, it will be included in the next payroll deduction (company drivers), settlement statement (owner-operators), weekly invoice (franchises), or load settlement (carriers)."
            technicalNotes="Transaction linked to settlement_batch_id when batch is created. Batch timing varies by entity type and pay schedule. Transaction status updated to 'pending_settlement' then 'settled' after batch processes."
            integrations={["Settlement Module", "Payroll System", "Invoicing System"]}
            successCriteria="Transaction in settlement queue with correct entity linkage and driver charge amount"
          />
        </div>
      </div>

      {/* Data Flow Diagram */}
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <h4 className="font-semibold mb-4">Transaction Data Flow</h4>
        <div className="flex items-center justify-between">
          <DataFlowNode label="Fuel Station" type="external" />
          <DataFlowArrow label="Transaction Data" />
          <DataFlowNode label="EFS/Commdata/Relay" type="platform" />
          <DataFlowArrow label="API Sync (15 min)" />
          <DataFlowNode label="AXIS Fuel Module" type="axis" />
          <DataFlowArrow label="Pricing + Logging" />
          <DataFlowNode label="Settlement Module" type="axis" />
        </div>
      </div>
    </div>
  );
}

function PricingCalculationFlow({ onStepClick }) {
  return (
    <div className="space-y-6">
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <div className="flex items-center gap-3 mb-6">
          <div className="w-10 h-10 bg-amber-500/20 rounded-lg flex items-center justify-center">
            <DollarSign className="w-5 h-5 text-amber-400" />
          </div>
          <div>
            <h3 className="font-semibold">Pricing Calculation Flow</h3>
            <p className="text-sm text-slate-500">How driver price is calculated for each transaction • Click any step for details</p>
          </div>
        </div>

        <div className="space-y-4">
          <FlowStep 
            step={1}
            title="Transaction Received"
            description="Raw transaction data arrives from fuel platform"
            actor="System"
            system="Fuel Integration Module"
            timing="Via API sync"
            color="blue"
            onStepClick={onStepClick}
            details={[
              "Pump Price: $3.42/gal",
              "Gallons: 127",
              "Location: Pilot #4521 (In-Network)",
              "Product: Diesel"
            ]}
            extendedDescription="When a new transaction is synced from the fuel platform, the pricing engine receives the raw transaction data including the retail pump price, quantity dispensed, fuel station location and network status, and product type. This is the starting point for all price calculations."
            technicalNotes="Transaction record created with status='pending_pricing'. Pump price is the retail price shown at station, before any discounts. Location includes lat/long and network_tier classification."
            integrations={["Transaction Sync Service", "Location Database"]}
            successCriteria="Transaction record exists with all required pricing inputs populated"
          />
          <FlowConnector />
          <FlowStep 
            step={2}
            title="Lookup Supplier Discount"
            description="System retrieves negotiated discount for this platform/location/product"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="purple"
            onStepClick={onStepClick}
            details={[
              "Platform: EFS",
              "Network Tier: In-Network",
              "Product: Diesel",
              "Discount: $0.08/gal"
            ]}
            extendedDescription="The system looks up the applicable supplier discount based on the combination of fuel platform, network tier (in-network vs out-of-network), and product type. These discounts are negotiated contracts stored in AXIS and are confidential—only visible to Mega Admin."
            technicalNotes="Discount lookup uses composite key: (platform_id, network_tier, product_type). If no exact match, falls back to default discount for platform. Volume tier bonuses may apply if monthly thresholds are met."
            integrations={["Supplier Discounts Database"]}
            errorHandling="If no discount found, defaults to $0 (no discount) and logs warning for admin review."
            successCriteria="Applicable discount rate retrieved and linked to transaction"
          />
          <FlowConnector />
          <FlowStep 
            step={3}
            title="Calculate Our Cost"
            description="Our Cost = Pump Price - Supplier Discount"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="amber"
            onStepClick={onStepClick}
            details={[
              "$3.42 - $0.08 = $3.34/gal",
              "Total Our Cost: $3.34 × 127 = $424.18"
            ]}
            extendedDescription="This calculation determines what Mega actually pays for the fuel after applying negotiated supplier discounts. This is the true cost basis and is kept confidential from all downstream entities including franchises, drivers, and carriers."
            technicalNotes="Formula: our_cost_per_gallon = pump_price_per_gallon - supplier_discount_per_gallon. Stored to 4 decimal places for accuracy. Total calculated as our_cost_per_gallon × gallons."
            successCriteria="our_cost_per_gallon and total_our_cost calculated and stored"
          />
          <FlowConnector />
          <FlowStep 
            step={4}
            title="Identify Driver's Pricing Model"
            description="Lookup assigned pricing model for this entity"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="purple"
            onStepClick={onStepClick}
            details={[
              "Entity: Miguel Rodriguez (Company Driver)",
              "Model: Tiered by Driver Score",
              "Current Tier: Gold (Score: 84)",
              "Gold Rate: Cost + 5%"
            ]}
            extendedDescription="Each card is linked to a pricing model that determines how the driver will be charged. The system retrieves the model type and current parameters. For tiered models, it also looks up the driver's current score tier."
            technicalNotes="Pricing model stored in fuel_cards.pricing_model_id. For tiered models, current tier is in driver_fuel_tier table, recalculated weekly. Model parameters include: model_type, rate/percentage, and any tier-specific rates."
            integrations={["Pricing Models Database", "Driver Tier Database"]}
            successCriteria="Pricing model identified with all required parameters for calculation"
          />
          <FlowConnector />
          <FlowStep 
            step={5}
            title="Apply Pricing Formula"
            description="Calculate driver price based on their model"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="amber"
            onStepClick={onStepClick}
            extendedDescription="The pricing engine applies the appropriate formula based on model type. Each model type has different calculation logic: tiered uses cost plus percentage by tier, fixed uses a static rate regardless of pump price, pump discount subtracts from pump price, per-mile defers to settlement calculation based on dispatched miles, and cost-plus adds a fixed amount or percentage to our cost."
            technicalNotes="Pricing formulas are implemented as strategy pattern. Each model type has a dedicated calculator class. Results are deterministic—same inputs always produce same output. All intermediate values logged for audit."
            integrations={["Pricing Calculator Engine"]}
            successCriteria="driver_price_per_gallon calculated according to model formula"
          />
          
          {/* Pricing Model Examples */}
          <div className="ml-8 bg-slate-800/50 rounded-lg p-4 border-l-4 border-amber-500">
            <p className="text-sm font-medium mb-3">Pricing Model Calculations:</p>
            <div className="space-y-3 text-sm">
              <div className="p-2 bg-slate-900 rounded">
                <p className="text-slate-400">Tiered (Gold - Cost + 5%)</p>
                <p className="font-mono text-amber-400">$3.34 × 1.05 = $3.51/gal</p>
              </div>
              <div className="p-2 bg-slate-900 rounded">
                <p className="text-slate-400">Fixed Rate ($3.29/gal)</p>
                <p className="font-mono text-amber-400">$3.29/gal (regardless of pump)</p>
              </div>
              <div className="p-2 bg-slate-900 rounded">
                <p className="text-slate-400">Pump Discount (Pump - $0.15)</p>
                <p className="font-mono text-amber-400">$3.42 - $0.15 = $3.27/gal</p>
              </div>
              <div className="p-2 bg-slate-900 rounded">
                <p className="text-slate-400">Per-Mile ($0.54/mile)</p>
                <p className="font-mono text-amber-400">Calculated at settlement based on dispatched miles</p>
              </div>
            </div>
          </div>

          <FlowConnector />
          <FlowStep 
            step={6}
            title="Calculate Margin"
            description="Margin = Driver Price - Our Cost"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="green"
            onStepClick={onStepClick}
            details={[
              "Driver Price: $3.51/gal",
              "Our Cost: $3.34/gal",
              "Margin: $0.17/gal (5.1%)",
              "Total Margin: $0.17 × 127 = $21.59"
            ]}
            extendedDescription="The margin represents the fuel program revenue—the difference between what the driver pays and what Mega pays. This margin funds fuel program operations and contributes to company revenue. Margins are tracked per transaction for detailed profitability reporting."
            technicalNotes="Formula: margin_per_gallon = driver_price_per_gallon - our_cost_per_gallon. Margin percentage = margin / our_cost × 100. Aggregated for daily, weekly, monthly reporting by entity type, fleet, and overall."
            successCriteria="Margin calculated and stored, transaction marked as 'pricing_complete'"
          />
          <FlowConnector />
          <FlowStep 
            step={7}
            title="Store All Price Points"
            description="System stores all three values for reporting and settlement"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="green"
            onStepClick={onStepClick}
            isLast
            details={[
              "pump_price_per_gallon: $3.42",
              "our_cost_per_gallon: $3.34",
              "driver_price_per_gallon: $3.51",
              "total_driver_charge: $445.77"
            ]}
            extendedDescription="All calculated values are persisted to the transaction record. This includes both per-gallon rates and total amounts. Having all price points stored enables accurate reporting, historical analysis, and audit trails even if pricing rules change in the future."
            technicalNotes="Transaction record updated atomically with all pricing fields. Status changed to 'priced'. Triggers settlement queue insertion. Data feeds into real-time dashboard metrics and historical reporting."
            integrations={["Transaction Database", "Settlement Queue", "Reporting Engine"]}
            successCriteria="All price points persisted, transaction ready for settlement processing"
          />
        </div>
      </div>

      {/* Visibility Matrix */}
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <h4 className="font-semibold mb-4">Price Visibility by Role</h4>
        <div className="overflow-x-auto">
          <table className="w-full text-sm">
            <thead>
              <tr className="text-left text-slate-500 border-b border-slate-800">
                <th className="px-4 py-3">Price Point</th>
                <th className="px-4 py-3">Mega Admin</th>
                <th className="px-4 py-3">Franchise Admin</th>
                <th className="px-4 py-3">Driver</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-slate-800">
              <tr>
                <td className="px-4 py-3 font-medium">Supplier Discount</td>
                <td className="px-4 py-3 text-green-400">✓ Visible</td>
                <td className="px-4 py-3 text-red-400">✗ Hidden</td>
                <td className="px-4 py-3 text-red-400">✗ Hidden</td>
              </tr>
              <tr>
                <td className="px-4 py-3 font-medium">Our Cost</td>
                <td className="px-4 py-3 text-green-400">✓ Visible</td>
                <td className="px-4 py-3 text-red-400">✗ Hidden</td>
                <td className="px-4 py-3 text-red-400">✗ Hidden</td>
              </tr>
              <tr>
                <td className="px-4 py-3 font-medium">Franchise Ceiling</td>
                <td className="px-4 py-3 text-green-400">✓ Visible</td>
                <td className="px-4 py-3 text-green-400">✓ Visible</td>
                <td className="px-4 py-3 text-red-400">✗ Hidden</td>
              </tr>
              <tr>
                <td className="px-4 py-3 font-medium">Driver Price</td>
                <td className="px-4 py-3 text-green-400">✓ Visible</td>
                <td className="px-4 py-3 text-green-400">✓ Visible</td>
                <td className="px-4 py-3 text-green-400">✓ Visible</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}

function FuelRecommendationFlow({ onStepClick }) {
  return (
    <div className="space-y-6">
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <div className="flex items-center gap-3 mb-6">
          <div className="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
            <MapPin className="w-5 h-5 text-blue-400" />
          </div>
          <div>
            <h3 className="font-semibold">Fuel Stop Recommendation Flow</h3>
            <p className="text-sm text-slate-500">Smart routing integrated with dispatch • Click any step for details</p>
          </div>
        </div>

        <div className="space-y-4">
          <FlowStep 
            step={1}
            title="Load Dispatched"
            description="New load assigned to driver with pickup, delivery, and deadline"
            actor="Dispatcher"
            system="AXIS Dispatch Module"
            timing="At dispatch"
            color="blue"
            onStepClick={onStepClick}
            details={[
              "Route: Dallas → Miami",
              "Deadline: Dec 14, 10:00 AM",
              "Driver: Miguel Rodriguez",
              "Truck: T-2847"
            ]}
            extendedDescription="When a load is dispatched to a driver, the Fuel Optimizer is triggered to analyze the route and proactively identify optimal fuel stops. This ensures drivers have recommendations before they need to make fuel decisions on the road."
            technicalNotes="Dispatch event triggers fuel_recommendation_job via message queue. Job receives: route_polyline, origin, destination, deadline_timestamp, driver_id, truck_id. Initial recommendation generated within 30 seconds of dispatch."
            integrations={["Dispatch Module", "Route Planning Engine", "Message Queue"]}
            successCriteria="Fuel optimization job triggered with all required route and driver data"
          />
          <FlowConnector />
          <FlowStep 
            step={2}
            title="Gather Real-Time Data"
            description="System collects current vehicle and driver state"
            actor="System (Automatic)"
            system="Telematics (Samsara) + ELD"
            timing="Real-time"
            color="purple"
            onStepClick={onStepClick}
            details={[
              "Current Fuel Level: 42% (~180 mi range)",
              "Truck MPG (historical): 6.8",
              "Driver HOS Remaining: 6.5 hours",
              "Current Location: I-20 near Shreveport"
            ]}
            extendedDescription="The optimizer gathers real-time data from multiple sources: current fuel tank level from telematics, the truck's historical MPG for accurate consumption estimates, driver's remaining hours of service from ELD, and current GPS location for distance calculations."
            technicalNotes="Telematics API called for fuel_level_percent and historical_mpg. ELD API provides hos_remaining_minutes. GPS coordinates used to calculate actual miles remaining vs route plan. Data cached for 5 minutes to reduce API calls."
            integrations={["Samsara Telematics API", "ELD Provider API", "GPS Tracking"]}
            errorHandling="If telematics data unavailable, falls back to estimated MPG from fleet average and assumes 50% fuel level. Alert generated for admin if data consistently missing."
            successCriteria="All real-time data points collected: fuel level, MPG, HOS, location"
          />
          <FlowConnector />
          <FlowStep 
            step={3}
            title="Calculate Fuel Requirement"
            description="Determine gallons needed to complete route with 15% reserve"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="amber"
            onStepClick={onStepClick}
            details={[
              "Miles Remaining: 847",
              "Expected Consumption: 847 ÷ 6.8 = 124.5 gal",
              "Current Tank: ~50 gal",
              "Needed: 124.5 - 50 + 15% reserve = ~90 gal"
            ]}
            extendedDescription="Using route distance and truck-specific MPG, the system calculates total fuel needed to reach the destination. It then factors in current tank level and adds a 15% safety reserve to determine how much fuel the driver needs to purchase."
            technicalNotes="Formula: fuel_needed = (remaining_miles / truck_mpg) - current_fuel + (remaining_miles / truck_mpg × 0.15). Tank capacity considered to avoid recommending more fuel than truck can hold. Multiple fill-ups may be recommended for very long routes."
            successCriteria="Accurate fuel requirement calculated with safety margin"
          />
          <FlowConnector />
          <FlowStep 
            step={4}
            title="Query In-Network Stations"
            description="Fetch all eligible fuel stops along the route"
            actor="System (Automatic)"
            system="Fuel Platform APIs"
            timing="< 2 seconds"
            color="purple"
            onStepClick={onStepClick}
            details={[
              "Filter: EFS in-network locations",
              "Buffer: 25 miles from route",
              "Returns: Location, current price, amenities"
            ]}
            extendedDescription="The system queries fuel platform APIs to get all in-network stations within a corridor along the planned route. It retrieves current pricing, location coordinates, and amenity information (parking, showers, etc.) for each station."
            technicalNotes="Route corridor defined as 25-mile buffer around route polyline. Spatial query uses PostGIS for efficient filtering. Price data refreshed hourly from platform APIs. Results cached for 15 minutes per route segment."
            integrations={["EFS Station API", "Commdata Station API", "Relay Station API", "Geospatial Database"]}
            successCriteria="List of in-network stations along route with current pricing"
          />
          <FlowConnector />
          <FlowStep 
            step={5}
            title="Apply Feasibility Filters"
            description="Eliminate stations that don't meet constraints"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="purple"
            onStepClick={onStepClick}
            details={[
              "Can reach with current fuel? → Keep / Exclude",
              "Fueling time + detour keeps ETA on track? → Keep / Exclude",
              "Driver has HOS for stop? → Keep / Exclude"
            ]}
            extendedDescription="Each potential station is evaluated against hard constraints. Stations the driver can't reach with current fuel are excluded. Stations that would cause late delivery are excluded. Stations requiring more time than the driver has on their HOS clock are excluded."
            technicalNotes="Constraints evaluated in order of computational cost (cheapest first). Reachability uses current_fuel × mpg. ETA impact calculated using traffic-aware routing API. HOS check includes estimated 30-minute stop duration."
            integrations={["Traffic API (Google/HERE)", "HOS Calculator"]}
            successCriteria="Filtered list of feasible stations that meet all constraints"
          />
          <FlowConnector />
          <FlowStep 
            step={6}
            title="Score & Rank Options"
            description="Calculate cost efficiency score for each viable stop"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="amber"
            onStepClick={onStepClick}
            details={[
              "Price Score: Driver price × estimated gallons",
              "Time Score: Minutes of route deviation",
              "Traffic Score: Current congestion at station area",
              "Weighted Formula: 60% price, 25% time, 15% traffic"
            ]}
            extendedDescription="Remaining stations are scored using a weighted formula that prioritizes cost savings while considering time impact. The score balances the driver's fuel price at that station, time deviation from optimal route, and current traffic conditions around the station."
            technicalNotes="Score = (price_score × 0.60) + (time_score × 0.25) + (traffic_score × 0.15). Lower scores are better. Price score = driver_price × gallons_needed. Time score = detour_minutes. Traffic score from real-time traffic API."
            integrations={["Pricing Engine", "Traffic API"]}
            successCriteria="All viable stations scored and sorted by efficiency"
          />
          <FlowConnector />
          <FlowStep 
            step={7}
            title="Generate Top 3 Recommendations"
            description="Package best options for driver"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="green"
            onStepClick={onStepClick}
            details={[
              "#1 Pilot #4521 - $3.24, 12 min detour, save $23.40",
              "#2 Love's #293 - $3.28, 8 min detour, save $18.20",
              "#3 TA #847 - $3.31, 15 min detour, save $14.60"
            ]}
            extendedDescription="The top 3 stations are formatted into driver-friendly recommendations showing the station name, driver's price, time impact, and estimated savings compared to alternatives. Savings are calculated versus the average price of other options."
            technicalNotes="Recommendation object includes: station_id, station_name, address, lat/long, driver_price, detour_minutes, estimated_gallons, estimated_savings, eta_to_station. Stored in fuel_recommendations table linked to load_id."
            integrations={["Driver App API"]}
            successCriteria="Top 3 recommendations generated with all display fields populated"
          />
          <FlowConnector />
          <FlowStep 
            step={8}
            title="Push Notification to Driver"
            description="Send recommendation via push notification + display in app"
            actor="System (Automatic)"
            system="Driver App"
            timing="Immediate"
            color="green"
            onStepClick={onStepClick}
            details={[
              "Push: 'Recommended Fuel Stop - Pilot #4521, 47 mi ahead'",
              "In-App: Full details with Navigate button"
            ]}
            extendedDescription="The driver receives both a push notification (appearing even if app is closed) and the full recommendation appears in their AXIS Driver App fuel section. The recommendation includes a one-tap Navigate button that opens directions in their preferred navigation app."
            technicalNotes="Push notification sent via Firebase Cloud Messaging (FCM) for Android, APNs for iOS. Deep link opens directly to fuel recommendation screen. Notification includes: station_name, distance_ahead, driver_price."
            integrations={["Push Notification Service (FCM/APNs)", "Driver App"]}
            successCriteria="Driver receives push notification AND recommendation visible in app"
          />
          <FlowConnector />
          <FlowStep 
            step={9}
            title="Driver Decision"
            description="Driver accepts recommendation or chooses alternative"
            actor="Driver"
            system="Driver App"
            timing="Driver discretion"
            color="blue"
            onStepClick={onStepClick}
            extendedDescription="The driver reviews the recommendations and decides whether to follow the suggested stop or choose an alternative. They can tap 'Navigate' to get directions to the recommended station, view alternatives, or dismiss the recommendation if they prefer a different option."
            technicalNotes="Driver interaction logged: recommendation_id, action (accepted/dismissed/alternative_selected), timestamp. If driver taps Navigate, navigation_started event logged. No penalty for dismissing recommendations."
            integrations={["Driver App", "Analytics"]}
            successCriteria="Driver makes informed decision with full visibility into options"
          />
          <FlowConnector />
          <FlowStep 
            step={10}
            title="Log Outcome for Analysis"
            description="Record whether recommendation was followed for effectiveness tracking"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="After fueling"
            color="green"
            onStepClick={onStepClick}
            isLast
            details={[
              "Recommended: Pilot #4521",
              "Actual Stop: [location]",
              "Followed: Yes/No",
              "Savings Captured: $X"
            ]}
            extendedDescription="When the driver's next fuel transaction is received, the system compares the actual stop location to the recommendation. This data feeds into optimization effectiveness reporting and helps improve future recommendations."
            technicalNotes="Matching logic uses station_id if exact match, or nearest-station lookup if within 1 mile. Savings calculated as: (actual_price - recommended_price) × gallons. Negative savings means driver paid more than recommended. Data feeds weekly effectiveness reports."
            integrations={["Transaction Sync", "Analytics Engine"]}
            successCriteria="Outcome recorded, effectiveness metrics updated, data available for reporting"
          />
        </div>
      </div>

      {/* Trigger Points */}
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <h4 className="font-semibold mb-4">When Recommendations Trigger</h4>
        <div className="grid grid-cols-3 gap-4">
          <TriggerCard 
            trigger="New Load Dispatch"
            description="Calculate optimal stops for entire route"
            timing="At dispatch"
          />
          <TriggerCard 
            trigger="Fuel Level Drops Below 30%"
            description="Proactive recommendation before critical"
            timing="Real-time monitoring"
          />
          <TriggerCard 
            trigger="Route Change"
            description="Recalculate if route or deadline changes"
            timing="On update"
          />
        </div>
      </div>
    </div>
  );
}

function SettlementBillingFlow({ onStepClick }) {
  return (
    <div className="space-y-6">
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <div className="flex items-center gap-3 mb-6">
          <div className="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center">
            <TrendingUp className="w-5 h-5 text-green-400" />
          </div>
          <div>
            <h3 className="font-semibold">Settlement & Billing Flow</h3>
            <p className="text-sm text-slate-500">How fuel charges reach each entity type • Click any step for details</p>
          </div>
        </div>

        {/* Entity Type Tabs */}
        <div className="grid grid-cols-4 gap-4 mb-6">
          <EntitySettlementCard 
            type="Company Driver"
            method="Payroll Deduction"
            timing="Per pay period"
            details={[
              "Fuel transactions aggregated",
              "Deducted from gross pay",
              "Shows as line item on pay stub"
            ]}
          />
          <EntitySettlementCard 
            type="Owner-Operator"
            method="Settlement Deduction"
            timing="Per settlement"
            details={[
              "Deducted from load settlement",
              "Itemized on settlement statement",
              "Diesel + DEF shown separately"
            ]}
          />
          <EntitySettlementCard 
            type="Franchise"
            method="Weekly Invoice"
            timing="Every Monday"
            details={[
              "All drivers' fuel aggregated",
              "Invoice sent to franchise",
              "Payment terms: Net 7"
            ]}
          />
          <EntitySettlementCard 
            type="Carrier (Brokerage)"
            method="Settlement Recapture"
            timing="Per load"
            details={[
              "Fuel advance deducted first",
              "Plus advance fee (if applicable)",
              "Net paid to carrier"
            ]}
          />
        </div>

        {/* Detailed Flow - Company Driver Example */}
        <div className="border border-slate-700 rounded-lg p-4">
          <h4 className="font-medium mb-4 text-amber-400">Example: Company Driver Pay Period Flow</h4>
          <div className="space-y-3">
            <FlowStep 
              step={1}
              title="Transactions Accumulate"
              description="Driver makes multiple fuel purchases during pay period"
              actor="System"
              system="Fuel Integration Module"
              timing="Ongoing"
              color="blue"
              compact
              onStepClick={onStepClick}
              extendedDescription="Throughout the pay period, every fuel transaction made by the driver is recorded and priced. Each transaction is linked to the driver's ID and tagged with the pay period identifier for later aggregation."
              technicalNotes="Transactions tagged with pay_period_id based on transaction timestamp. Pay periods defined in payroll_schedules table. Company drivers typically bi-weekly or weekly depending on payroll setup."
              integrations={["Transaction Processing", "Payroll Schedule"]}
              successCriteria="All transactions properly tagged with pay period and driver ID"
            />
            <FlowConnector compact />
            <FlowStep 
              step={2}
              title="Pay Period Closes"
              description="System aggregates all transactions for period"
              actor="System (Automatic)"
              system="Fuel Integration Module"
              timing="Pay period end"
              color="purple"
              compact
              onStepClick={onStepClick}
              details={[
                "Diesel: 412 gal @ driver rate = $1,378.12",
                "DEF: 48 gal @ driver rate = $142.56",
                "Total: $1,520.68"
              ]}
              extendedDescription="When the pay period closes, the system runs an aggregation job that totals all fuel transactions by product type. Diesel and DEF are calculated separately to appear as distinct line items on the pay stub."
              technicalNotes="Aggregation job runs at pay period cutoff time (typically midnight). Grouped by driver_id, product_type. Calculates: sum(gallons), sum(driver_charge). Creates fuel_deduction record with status='pending'."
              integrations={["Aggregation Engine", "Deduction Records"]}
              successCriteria="Fuel deduction record created with accurate totals by product type"
            />
            <FlowConnector compact />
            <FlowStep 
              step={3}
              title="Send to Payroll"
              description="Fuel deduction sent to payroll system"
              actor="System (Automatic)"
              system="Settlement Module → Payroll"
              timing="Before payroll run"
              color="purple"
              compact
              onStepClick={onStepClick}
              extendedDescription="The aggregated fuel deduction is transmitted to the payroll system in the format it requires. This typically happens 1-2 days before payroll processing to allow time for verification."
              technicalNotes="Integration via API or file export depending on payroll provider. Deduction record includes: driver_id, deduction_type='fuel', deduction_amount, line_item_details (JSON). Status updated to 'sent_to_payroll'."
              integrations={["Payroll System API", "Settlement Module"]}
              errorHandling="If payroll integration fails, alert sent to payroll team for manual entry. Deduction record marked 'integration_failed' for tracking."
              successCriteria="Deduction successfully transmitted and acknowledged by payroll system"
            />
            <FlowConnector compact />
            <FlowStep 
              step={4}
              title="Payroll Processed"
              description="Fuel deducted from driver's gross pay"
              actor="Payroll System"
              system="Payroll"
              timing="Pay date"
              color="green"
              compact
              onStepClick={onStepClick}
              extendedDescription="The payroll system processes the pay run, including the fuel deduction as a line item. The deduction reduces the driver's gross pay before calculating net pay."
              technicalNotes="Deduction appears in earnings_and_deductions section of payroll. Some systems categorize as 'fuel expense reimbursement' or 'fuel advance recovery'. Tax treatment depends on payroll configuration."
              integrations={["Payroll System"]}
              successCriteria="Payroll processed with fuel deduction applied correctly"
            />
            <FlowConnector compact />
            <FlowStep 
              step={5}
              title="Driver Receives Pay Stub"
              description="Pay stub shows fuel as deduction line item"
              actor="Driver"
              system="Payroll"
              timing="Pay date"
              color="green"
              compact
              onStepClick={onStepClick}
              isLast
              extendedDescription="The driver receives their pay stub (digital or paper) showing fuel deductions as separate line items. They can see total diesel charges and total DEF charges for the pay period."
              technicalNotes="Pay stub line items: 'Fuel - Diesel: $1,378.12' and 'Fuel - DEF: $142.56'. Driver can reconcile against their transaction history in the AXIS Driver App."
              successCriteria="Driver has visibility into fuel deductions on pay stub"
            />
          </div>
        </div>
      </div>

      {/* DEF Separation Note */}
      <div className="bg-blue-500/10 border border-blue-500/20 rounded-lg p-4 flex items-start gap-3">
        <Fuel className="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5" />
        <div>
          <p className="text-blue-400 font-medium">DEF Tracked Separately</p>
          <p className="text-sm text-slate-400 mt-1">All settlement statements show Diesel, DEF, and Reefer as separate line items for clarity and compliance.</p>
        </div>
      </div>
    </div>
  );
}

function CardSuspensionFlow({ onStepClick }) {
  return (
    <div className="space-y-6">
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <div className="flex items-center gap-3 mb-6">
          <div className="w-10 h-10 bg-red-500/20 rounded-lg flex items-center justify-center">
            <Shield className="w-5 h-5 text-red-400" />
          </div>
          <div>
            <h3 className="font-semibold">Card Suspension Flow</h3>
            <p className="text-sm text-slate-500">Automatic and manual suspension triggers • Click any step for details</p>
          </div>
        </div>

        {/* Automatic Triggers */}
        <div className="mb-6">
          <h4 className="font-medium mb-4 text-amber-400">Automatic Suspension Triggers</h4>
          <div className="grid grid-cols-2 gap-4">
            <SuspensionTrigger 
              trigger="Driver Score Below 50"
              description="Weekly score recalculation drops below threshold"
              action="Immediate card suspension"
              reversible="Auto-reactivates when score returns above 50"
              configurable
            />
            <SuspensionTrigger 
              trigger="Failed Drug Test"
              description="Drug test result marked as failed in AXIS"
              action="Immediate card suspension"
              reversible="Manual reactivation only"
            />
            <SuspensionTrigger 
              trigger="Driver Marked Inactive"
              description="Driver status changed to inactive/terminated"
              action="Immediate card suspension"
              reversible="Reactivates if status restored"
            />
            <SuspensionTrigger 
              trigger="Settlement Balance Exceeded"
              description="Outstanding fuel balance exceeds $2,500"
              action="Card suspended until balance reduced"
              reversible="Auto-reactivates when under threshold"
              configurable
            />
          </div>
        </div>

        {/* Flow Steps */}
        <div className="space-y-4">
          <FlowStep 
            step={1}
            title="Trigger Event Detected"
            description="System detects condition that triggers suspension"
            actor="System (Automatic)"
            system="AXIS Core / Safety Module"
            timing="Real-time or scheduled"
            color="red"
            onStepClick={onStepClick}
            extendedDescription="Various AXIS modules monitor for suspension trigger conditions. The Safety Module tracks driver scores (weekly). HR events trigger on status changes. Drug test results arrive via API. Settlement Module monitors balance thresholds in real-time."
            technicalNotes="Events published to suspension_events message queue. Event payload includes: driver_id, trigger_type, trigger_value, timestamp. Multiple triggers can fire simultaneously—all are processed."
            integrations={["Safety Module", "HR Module", "Drug Test API", "Settlement Module"]}
            successCriteria="Suspension event created and queued for processing"
          />
          <FlowConnector />
          <FlowStep 
            step={2}
            title="Suspension Decision"
            description="System confirms suspension criteria met"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="red"
            onStepClick={onStepClick}
            extendedDescription="The Fuel Integration Module receives the suspension event and validates that the criteria are still met (driver score still below threshold, status still inactive, etc.). This prevents race conditions where the condition was briefly triggered but immediately resolved."
            technicalNotes="Validation re-queries the source system to confirm current state. If condition no longer met, event is logged but no action taken. Configurable thresholds retrieved from fuel_settings table."
            integrations={["Source Module APIs", "Settings Database"]}
            errorHandling="If source system unavailable for validation, suspension proceeds with alert to admin for manual verification."
            successCriteria="Suspension criteria confirmed, card flagged for suspension"
          />
          <FlowConnector />
          <FlowStep 
            step={3}
            title="API Call to Platform"
            description="Send suspend command to EFS/Commdata/Relay"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="purple"
            onStepClick={onStepClick}
            extendedDescription="The system makes an API call to the driver's fuel card platform instructing it to suspend the card. This prevents any new authorizations while preserving the card record for potential reactivation."
            technicalNotes="API endpoint: POST /cards/{card_id}/suspend. Includes suspension_reason code for platform records. Retry logic with 3 attempts and exponential backoff. Card status updated locally immediately regardless of API response."
            integrations={["EFS Card API", "Commdata Card API", "Relay Card API"]}
            errorHandling="If API call fails after retries, local card marked suspended and queued for retry. Driver still blocked from fueling even if platform update delayed."
            successCriteria="Platform acknowledges suspension command"
          />
          <FlowConnector />
          <FlowStep 
            step={4}
            title="Card Suspended in Platform"
            description="Fuel platform disables card for transactions"
            actor="External Platform"
            system="EFS / Commdata / Relay"
            timing="< 1 minute"
            color="red"
            onStepClick={onStepClick}
            extendedDescription="The fuel card platform updates the card status to suspended. Any subsequent swipe attempts will be declined at the pump. The card data is preserved for potential reactivation."
            technicalNotes="Platform typically processes suspension within seconds. Card enters 'suspended' state in platform's system. Some platforms send webhook confirmation which AXIS logs."
            successCriteria="Card no longer authorizes transactions at fuel stations"
          />
          <FlowConnector />
          <FlowStep 
            step={5}
            title="Notifications Sent"
            description="Alert relevant parties"
            actor="System (Automatic)"
            system="Notification Service"
            timing="Immediate"
            color="amber"
            onStepClick={onStepClick}
            details={[
              "Driver: Push notification + SMS",
              "Fleet Manager: Email alert",
              "Safety Manager: Dashboard notification"
            ]}
            extendedDescription="Multiple stakeholders are notified of the suspension through their preferred channels. The driver receives immediate notification explaining why their card was suspended. Managers are alerted so they can take appropriate action or provide support."
            technicalNotes="Notification templates stored by suspension_reason. Driver notification includes: reason, steps to resolve (if applicable). Manager notification includes: driver_id, driver_name, suspension_reason, timestamp."
            integrations={["Push Notification Service", "SMS Gateway", "Email Service", "Dashboard Alerts"]}
            successCriteria="All relevant parties notified through appropriate channels"
          />
          <FlowConnector />
          <FlowStep 
            step={6}
            title="Suspension Logged"
            description="Record suspension event for audit trail"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="purple"
            onStepClick={onStepClick}
            isLast
            extendedDescription="The complete suspension event is logged with all details for compliance and audit purposes. This record enables reporting on suspension frequency, reasons, and resolution times."
            technicalNotes="Log entry includes: card_id, driver_id, suspension_reason, trigger_details, timestamp, platform_confirmation, notifications_sent. Records are immutable and retained per data retention policy."
            integrations={["Audit Log Database", "Reporting Engine"]}
            successCriteria="Complete audit trail created for the suspension event"
          />
        </div>
      </div>

      {/* Reactivation Flow */}
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <h4 className="font-semibold mb-4">Reactivation Process</h4>
        <div className="grid grid-cols-2 gap-6">
          <div className="bg-green-500/10 border border-green-500/20 rounded-lg p-4">
            <h5 className="font-medium text-green-400 mb-2">Automatic Reactivation</h5>
            <ul className="text-sm text-slate-400 space-y-1">
              <li>• Driver score returns above threshold</li>
              <li>• Settlement balance reduced below limit</li>
              <li>• Driver status restored to active</li>
              <li className="text-green-400 pt-2">→ System auto-reactivates within 15 min</li>
            </ul>
          </div>
          <div className="bg-amber-500/10 border border-amber-500/20 rounded-lg p-4">
            <h5 className="font-medium text-amber-400 mb-2">Manual Reactivation Required</h5>
            <ul className="text-sm text-slate-400 space-y-1">
              <li>• Failed drug test (requires new clean test)</li>
              <li>• Fraud investigation flag</li>
              <li>• Manual admin suspension</li>
              <li className="text-amber-400 pt-2">→ Admin must manually reactivate</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  );
}

function FranchisePricingFlow({ onStepClick }) {
  return (
    <div className="space-y-6">
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <div className="flex items-center gap-3 mb-6">
          <div className="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center">
            <Building2 className="w-5 h-5 text-purple-400" />
          </div>
          <div>
            <h3 className="font-semibold">Franchise Pricing Flow</h3>
            <p className="text-sm text-slate-500">How franchises set pricing for their drivers • Click any step for details</p>
          </div>
        </div>

        <div className="space-y-4">
          <FlowStep 
            step={1}
            title="Mega Admin Sets Franchise Ceiling"
            description="Mega assigns maximum rate that franchise can charge"
            actor="Mega Admin"
            system="Fuel Integration Module"
            timing="At franchise setup"
            color="amber"
            onStepClick={onStepClick}
            details={[
              "Model: Cost + 8%",
              "This is the franchise's 'cost' - what they pay Mega"
            ]}
            extendedDescription="When a franchise is set up in AXIS, the Mega Admin assigns a pricing ceiling that represents the franchise's cost for fuel. This rate is based on Mega's internal cost plus a markup. The franchise cannot see Mega's actual supplier costs, only this ceiling rate."
            technicalNotes="Ceiling stored in franchise_fuel_pricing table: franchise_id, ceiling_type ('cost_plus_percent'), ceiling_value (8), effective_date. Ceiling can be updated but changes only affect future transactions."
            integrations={["Franchise Management", "Pricing Models Database"]}
            successCriteria="Franchise has assigned ceiling rate that defines their cost basis"
          />
          <FlowConnector />
          <FlowStep 
            step={2}
            title="Franchise Views Their Ceiling"
            description="Franchise admin sees their assigned rate (but NOT supplier costs)"
            actor="Franchise Admin"
            system="Franchise Portal"
            timing="Anytime"
            color="blue"
            onStepClick={onStepClick}
            details={[
              "Sees: 'Your Cost: Cost + 8%' (≈ $3.42/gal today)",
              "Cannot see: Original supplier discount or Mega's actual cost"
            ]}
            extendedDescription="In the Franchise Portal, franchise administrators can view their assigned rate from Mega. The system shows them an approximate dollar amount based on current pump prices, but they cannot see Mega's negotiated supplier discounts or true cost."
            technicalNotes="API filters pricing data to show only ceiling-level and below. Current approximate price calculated using: avg_pump_price × (1 + ceiling_percent). Updated hourly based on recent transaction pump prices."
            integrations={["Franchise Portal", "Pricing Display Engine"]}
            successCriteria="Franchise admin has visibility into their cost basis for pricing decisions"
          />
          <FlowConnector />
          <FlowStep 
            step={3}
            title="Franchise Sets Driver Pricing"
            description="Franchise creates pricing model for their drivers"
            actor="Franchise Admin"
            system="Franchise Portal"
            timing="At setup or update"
            color="purple"
            onStepClick={onStepClick}
            details={[
              "Must be ≥ their ceiling",
              "Example: Cost + 11% (gives 3% margin)"
            ]}
            extendedDescription="The franchise admin creates or updates pricing rules for their drivers. They can set a rate that must be equal to or greater than their assigned ceiling. The difference between their driver rate and their ceiling becomes the franchise's fuel margin."
            technicalNotes="Franchise pricing stored in franchise_driver_pricing table: franchise_id, pricing_type, pricing_value, applies_to (all drivers or specific). Multiple pricing models can exist for different driver groups within franchise."
            integrations={["Franchise Portal", "Pricing Validation Engine"]}
            successCriteria="Franchise driver pricing created and saved"
          />
          <FlowConnector />
          <FlowStep 
            step={4}
            title="System Validates Pricing"
            description="AXIS ensures franchise rate ≥ their assigned ceiling"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="purple"
            onStepClick={onStepClick}
            details={[
              "If franchise tries Cost + 6% (below ceiling): REJECTED",
              "If franchise sets Cost + 11% (above ceiling): ACCEPTED"
            ]}
            extendedDescription="Before saving any franchise pricing, the system validates that the proposed rate is at or above their ceiling. This guardrail ensures the franchise doesn't accidentally price below their cost and guarantees Mega's margin is preserved."
            technicalNotes="Validation: franchise_rate >= franchise_ceiling. If validation fails, API returns 400 error with message explaining minimum allowed rate. All validation attempts logged for audit."
            errorHandling="Rejected pricing attempts trigger UI error message explaining the minimum rate. No partial saves allowed—either all pricing validates or none is saved."
            successCriteria="Pricing accepted only if at or above franchise ceiling"
          />
          <FlowConnector />
          <FlowStep 
            step={5}
            title="Pricing Applied to Franchise Drivers"
            description="All drivers under this franchise use the franchise's rate"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="green"
            onStepClick={onStepClick}
            extendedDescription="Once saved, the franchise's pricing model is automatically applied to all fuel cards associated with that franchise's drivers. New drivers onboarded to the franchise automatically receive this pricing."
            technicalNotes="Pricing model linked via: fuel_cards.pricing_model_id references franchise_driver_pricing.id for franchise drivers. Pricing changes take effect on next transaction—no retroactive repricing."
            integrations={["Card Management", "Driver Onboarding"]}
            successCriteria="All franchise driver cards linked to franchise pricing model"
          />
          <FlowConnector />
          <FlowStep 
            step={6}
            title="Driver Makes Purchase"
            description="Franchise driver fuels at in-network station"
            actor="Driver"
            system="Fuel Station"
            timing="Real-time"
            color="blue"
            onStepClick={onStepClick}
            extendedDescription="A driver employed by the franchise uses their fuel card at a station. The transaction flows through normal processing channels and is tagged with the franchise identifier for proper pricing and billing."
            successCriteria="Transaction completed and data transmitted to platform"
          />
          <FlowConnector />
          <FlowStep 
            step={7}
            title="Transaction Priced"
            description="System calculates multiple price points"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="On sync"
            color="amber"
            onStepClick={onStepClick}
            details={[
              "Pump Price: $3.42",
              "Mega's Cost: $3.34 (pump - supplier discount)",
              "Franchise Cost: $3.42 (Mega cost × 1.08)",
              "Driver Price: $3.52 (Mega cost × 1.11)"
            ]}
            extendedDescription="The pricing engine calculates four price points for franchise transactions: the original pump price, Mega's true cost after supplier discounts, the franchise's cost (their ceiling), and the driver's price (franchise's markup). Each level only sees their respective downstream prices."
            technicalNotes="Calculations: mega_cost = pump - supplier_discount. franchise_cost = mega_cost × (1 + ceiling_percent). driver_price = mega_cost × (1 + franchise_rate_percent). All four values stored on transaction record."
            integrations={["Pricing Engine", "Transaction Database"]}
            successCriteria="All four price points calculated and stored correctly"
          />
          <FlowConnector />
          <FlowStep 
            step={8}
            title="Margins Calculated"
            description="System determines revenue for each party"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="On sync"
            color="green"
            onStepClick={onStepClick}
            isLast
            details={[
              "Mega Margin: $3.42 - $3.34 = $0.08/gal",
              "Franchise Margin: $3.52 - $3.42 = $0.10/gal",
              "Driver sees only: $3.52/gal"
            ]}
            extendedDescription="The final margins are calculated showing how revenue splits between Mega and the franchise. Mega earns the difference between their cost and the franchise ceiling. The franchise earns the difference between their ceiling and driver price. The driver only ever sees their final price."
            technicalNotes="mega_margin = franchise_cost - mega_cost. franchise_margin = driver_price - franchise_cost. Margins used for reporting and analytics. Driver-facing systems only have access to driver_price field."
            integrations={["Margin Analytics", "Reporting Engine"]}
            successCriteria="Both margins calculated and available for reporting by appropriate parties"
          />
        </div>
      </div>

      {/* Waterfall Visualization */}
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <h4 className="font-semibold mb-4">Franchise Pricing Waterfall Example</h4>
        <div className="flex items-end justify-around h-64 px-8">
          <WaterfallBar label="Pump Price" value={3.42} height={100} color="slate" />
          <WaterfallBar label="Supplier Discount" value={-0.08} height={-8} color="green" isDeduction />
          <WaterfallBar label="Mega's Cost" value={3.34} height={92} color="red" />
          <WaterfallBar label="Mega Markup (8%)" value={0.08} height={8} color="amber" />
          <WaterfallBar label="Franchise Cost" value={3.42} height={100} color="purple" />
          <WaterfallBar label="Franchise Markup (3%)" value={0.10} height={10} color="blue" />
          <WaterfallBar label="Driver Price" value={3.52} height={110} color="green" isFinal />
        </div>
        <div className="mt-4 flex justify-center gap-8 text-sm">
          <div className="flex items-center gap-2">
            <div className="w-3 h-3 bg-red-500/50 rounded" />
            <span className="text-slate-400">Hidden from Franchise</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="w-3 h-3 bg-purple-500/50 rounded" />
            <span className="text-slate-400">Franchise's View</span>
          </div>
          <div className="flex items-center gap-2">
            <div className="w-3 h-3 bg-green-500/50 rounded" />
            <span className="text-slate-400">Driver's View</span>
          </div>
        </div>
      </div>
    </div>
  );
}

function TierRecalculationFlow({ onStepClick }) {
  return (
    <div className="space-y-6">
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <div className="flex items-center gap-3 mb-6">
          <div className="w-10 h-10 bg-amber-500/20 rounded-lg flex items-center justify-center">
            <Target className="w-5 h-5 text-amber-400" />
          </div>
          <div>
            <h3 className="font-semibold">Driver Score & Tier Recalculation Flow</h3>
            <p className="text-sm text-slate-500">Weekly scoring that affects fuel pricing • Click any step for details</p>
          </div>
        </div>

        <div className="space-y-4">
          <FlowStep 
            step={1}
            title="Weekly Recalculation Triggers"
            description="System initiates score recalculation every Sunday at midnight"
            actor="System (Scheduled)"
            system="Safety Module"
            timing="Sunday 00:00"
            color="purple"
            onStepClick={onStepClick}
            extendedDescription="A scheduled job runs every Sunday at midnight to recalculate driver scores for all active drivers. This weekly cadence balances timely feedback with allowing enough time for meaningful performance changes."
            technicalNotes="Cron job: 0 0 * * 0. Job creates score_calculation_batch record and iterates through all active drivers. Batch processing with parallel threads for performance. Typical runtime: 5-15 minutes for 400+ drivers."
            integrations={["Job Scheduler", "Driver Database"]}
            successCriteria="Score recalculation batch initiated for all active drivers"
          />
          <FlowConnector />
          <FlowStep 
            step={2}
            title="Gather Safety Data"
            description="Pull safety metrics from past 30 days"
            actor="System (Automatic)"
            system="Safety Module + ELD"
            timing="During job"
            color="blue"
            onStepClick={onStepClick}
            details={[
              "HOS violations count",
              "Hard braking events",
              "Speeding incidents",
              "Accident history",
              "Weight: 40% of total score"
            ]}
            extendedDescription="Safety data is the largest component of the driver score at 40%. The system pulls the last 30 days of safety events including hours of service violations, hard braking events from telematics, speeding incidents, and any accidents. Fewer incidents means a higher safety score."
            technicalNotes="Safety API returns: hos_violations_count, hard_braking_events, speeding_events, accident_count. Each metric normalized to 0-100 scale based on fleet benchmarks. Safety sub-score = weighted average of normalized metrics."
            integrations={["Safety Module API", "ELD Provider API", "Telematics API"]}
            successCriteria="Safety sub-score calculated (0-100) for the driver"
          />
          <FlowConnector />
          <FlowStep 
            step={3}
            title="Gather Fuel Efficiency Data"
            description="Calculate MPG and idle metrics"
            actor="System (Automatic)"
            system="Telematics (Samsara)"
            timing="During job"
            color="blue"
            onStepClick={onStepClick}
            details={[
              "Actual MPG vs fleet average",
              "Idle time percentage",
              "Fuel usage patterns",
              "Weight: 25% of total score"
            ]}
            extendedDescription="Fuel efficiency accounts for 25% of the score. The system calculates the driver's actual MPG over the past 30 days and compares it to the fleet average for similar trucks/routes. Idle time percentage and fuel usage patterns are also factored in."
            technicalNotes="Telematics API returns: actual_mpg, idle_percent, total_gallons, total_miles. Fleet average calculated by truck type. Efficiency score = (driver_mpg / fleet_avg_mpg) × 100, capped at 100. Idle penalty applied if idle_percent > threshold."
            integrations={["Samsara API", "Fleet Analytics"]}
            successCriteria="Efficiency sub-score calculated (0-100) for the driver"
          />
          <FlowConnector />
          <FlowStep 
            step={4}
            title="Gather Reliability Data"
            description="Pull delivery and load metrics"
            actor="System (Automatic)"
            system="Dispatch Module"
            timing="During job"
            color="blue"
            onStepClick={onStepClick}
            details={[
              "On-time delivery percentage",
              "Load acceptance rate",
              "Customer complaints",
              "Weight: 20% of total score"
            ]}
            extendedDescription="Reliability is weighted at 20% and measures how dependably the driver executes their assignments. On-time delivery percentage is the primary metric, supplemented by load acceptance rate (for drivers who can decline loads) and any customer complaints received."
            technicalNotes="Dispatch API returns: loads_completed, loads_on_time, loads_offered (if applicable), loads_accepted, complaints_count. On-time percent = on_time / completed × 100. Acceptance rate only applies to O/Os and certain company driver arrangements."
            integrations={["Dispatch Module API", "Customer Feedback System"]}
            successCriteria="Reliability sub-score calculated (0-100) for the driver"
          />
          <FlowConnector />
          <FlowStep 
            step={5}
            title="Calculate Tenure Factor"
            description="Factor in driver longevity"
            actor="System (Automatic)"
            system="HR Module"
            timing="During job"
            color="blue"
            onStepClick={onStepClick}
            details={[
              "Months with company",
              "Consistency of performance",
              "Weight: 15% of total score"
            ]}
            extendedDescription="Tenure accounts for 15% of the score and rewards long-term drivers. Months of service is the primary factor, with additional weight given to drivers who have consistently maintained good scores over time rather than fluctuating."
            technicalNotes="HR API returns: hire_date, active_months. Tenure score: 6+ months = 70, 12+ months = 85, 24+ months = 95, 36+ months = 100. Consistency bonus: +5 if no tier drops in past 6 months."
            integrations={["HR Module API", "Historical Score Database"]}
            successCriteria="Tenure sub-score calculated (0-100) for the driver"
          />
          <FlowConnector />
          <FlowStep 
            step={6}
            title="Compute Composite Score"
            description="Calculate weighted average"
            actor="System (Automatic)"
            system="Safety Module"
            timing="During job"
            color="amber"
            onStepClick={onStepClick}
            details={[
              "Score = (Safety × 0.40) + (Efficiency × 0.25) + (Reliability × 0.20) + (Tenure × 0.15)",
              "Result: 0-100 scale"
            ]}
            extendedDescription="The four sub-scores are combined using the defined weights to produce a single composite score from 0-100. This formula can be adjusted by administrators but changes affect all drivers consistently."
            technicalNotes="Formula applied: composite = (safety × 0.40) + (efficiency × 0.25) + (reliability × 0.20) + (tenure × 0.15). Result rounded to 1 decimal place. All sub-scores and weights logged for audit and dispute resolution."
            integrations={["Score Calculation Engine"]}
            successCriteria="Composite driver score calculated (0-100)"
          />
          <FlowConnector />
          <FlowStep 
            step={7}
            title="Determine Tier"
            description="Map score to pricing tier"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="purple"
            onStepClick={onStepClick}
            details={[
              "90-100 → Platinum (Cost + 3%)",
              "80-89 → Gold (Cost + 5%)",
              "70-79 → Silver (Cost + 7%)",
              "0-69 → Bronze (Cost + 10%)"
            ]}
            extendedDescription="The composite score is mapped to one of four pricing tiers. Each tier has a defined score range and corresponding fuel pricing markup. Higher tiers receive better fuel pricing as a reward for strong performance."
            technicalNotes="Tier thresholds stored in fuel_settings.tier_thresholds (configurable). Mapping: score >= 90 → Platinum, >= 80 → Gold, >= 70 → Silver, else Bronze. Tier name and pricing rate retrieved from pricing_tiers table."
            integrations={["Tier Configuration", "Pricing Models"]}
            successCriteria="Appropriate tier assigned based on score thresholds"
          />
          <FlowConnector />
          <FlowStep 
            step={8}
            title="Compare to Previous Tier"
            description="Check if tier changed from last week"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="purple"
            onStepClick={onStepClick}
            extendedDescription="The newly calculated tier is compared to the driver's tier from the previous week. This comparison determines whether any notifications need to be sent and tracks tier movement for analytics."
            technicalNotes="Previous tier retrieved from driver_fuel_tier.previous_tier. Comparison: if new_tier != previous_tier then tier_changed = true. Change direction determined: 'promoted' if new tier is higher, 'demoted' if lower."
            integrations={["Driver Tier History"]}
            successCriteria="Tier change status determined (changed/unchanged, direction)"
          />
          <FlowConnector />
          <FlowStep 
            step={9}
            title="Update Pricing Model"
            description="If tier changed, update driver's assigned pricing"
            actor="System (Automatic)"
            system="Fuel Integration Module"
            timing="Immediate"
            color="amber"
            onStepClick={onStepClick}
            extendedDescription="If the tier changed, the driver's fuel card pricing model is updated to reflect the new tier's rate. This change takes effect immediately—the next fuel transaction will use the new pricing."
            technicalNotes="Update fuel_cards.pricing_tier = new_tier. Pricing model parameters automatically adjust based on tier. Update timestamp recorded. Historical tier record created in driver_tier_history table."
            integrations={["Card Management", "Pricing Engine"]}
            successCriteria="Driver's pricing tier updated in fuel card record"
          />
          <FlowConnector />
          <FlowStep 
            step={10}
            title="Notify Driver"
            description="Send notification if tier changed"
            actor="System (Automatic)"
            system="Notification Service"
            timing="Immediate"
            color="green"
            onStepClick={onStepClick}
            isLast
            details={[
              "Promotion: 'Congrats! You moved to Gold tier!'",
              "Demotion: 'Your tier changed to Silver. Here's how to improve.'",
              "No Change: No notification sent"
            ]}
            extendedDescription="Drivers are notified when their tier changes. Promotions receive congratulatory messages celebrating the achievement. Demotions include constructive messaging with specific suggestions for improvement. If the tier didn't change, no notification is sent to avoid notification fatigue."
            technicalNotes="Notification templates: tier_promotion, tier_demotion. Promotion includes: new_tier, new_pricing, encouragement. Demotion includes: new_tier, new_pricing, lowest sub-score area, improvement tips. Sent via push notification to driver app."
            integrations={["Push Notification Service", "Driver App"]}
            successCriteria="Driver appropriately notified (or no notification if tier unchanged)"
          />
        </div>
      </div>

      {/* Score Component Breakdown */}
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <h4 className="font-semibold mb-4">Score Component Weights</h4>
        <div className="grid grid-cols-4 gap-4">
          <ScoreWeightCard component="Safety" weight={40} metrics={["HOS Violations", "Hard Braking", "Speeding", "Accidents"]} color="red" />
          <ScoreWeightCard component="Fuel Efficiency" weight={25} metrics={["MPG vs Average", "Idle Time %", "Fuel Patterns"]} color="green" />
          <ScoreWeightCard component="Reliability" weight={20} metrics={["On-Time %", "Load Accept Rate", "Complaints"]} color="blue" />
          <ScoreWeightCard component="Tenure" weight={15} metrics={["Months Active", "Consistency"]} color="purple" />
        </div>
      </div>

      {/* Tier Thresholds */}
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <h4 className="font-semibold mb-4">Tier Thresholds & Pricing Impact</h4>
        <div className="flex items-center justify-between">
          <TierThresholdBar tier="Bronze" range="0-69" rate="Cost + 10%" color="orange" />
          <TierThresholdBar tier="Silver" range="70-79" rate="Cost + 7%" color="slate" />
          <TierThresholdBar tier="Gold" range="80-89" rate="Cost + 5%" color="amber" />
          <TierThresholdBar tier="Platinum" range="90-100" rate="Cost + 3%" color="purple" />
        </div>
        <p className="text-xs text-slate-500 mt-4 text-center">Difference between Bronze and Platinum: 7% on every gallon</p>
      </div>
    </div>
  );
}

// ============ PROCESS FLOW HELPER COMPONENTS ============

function StepDetailModal({ step, onClose }) {
  return (
    <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4" onClick={onClose}>
      <div 
        className="bg-slate-900 rounded-2xl border border-slate-700 w-full max-w-2xl max-h-[90vh] overflow-hidden shadow-2xl"
        onClick={(e) => e.stopPropagation()}
      >
        {/* Modal Header */}
        <div className={`p-6 border-b border-slate-800 bg-gradient-to-r ${
          step.color === 'blue' ? 'from-blue-500/20 to-blue-600/10' :
          step.color === 'purple' ? 'from-purple-500/20 to-purple-600/10' :
          step.color === 'green' ? 'from-green-500/20 to-green-600/10' :
          step.color === 'amber' ? 'from-amber-500/20 to-amber-600/10' :
          'from-red-500/20 to-red-600/10'
        }`}>
          <div className="flex items-start justify-between">
            <div className="flex items-center gap-4">
              <div className={`w-14 h-14 rounded-xl flex items-center justify-center border-2 ${
                step.color === 'blue' ? 'bg-blue-500/20 border-blue-500/50 text-blue-400' :
                step.color === 'purple' ? 'bg-purple-500/20 border-purple-500/50 text-purple-400' :
                step.color === 'green' ? 'bg-green-500/20 border-green-500/50 text-green-400' :
                step.color === 'amber' ? 'bg-amber-500/20 border-amber-500/50 text-amber-400' :
                'bg-red-500/20 border-red-500/50 text-red-400'
              }`}>
                <span className="text-2xl font-bold">{step.step}</span>
              </div>
              <div>
                <h3 className="text-xl font-bold">{step.title}</h3>
                <p className="text-slate-400 mt-1">{step.description}</p>
              </div>
            </div>
            <button 
              onClick={onClose}
              className="w-10 h-10 rounded-lg bg-slate-800 hover:bg-slate-700 flex items-center justify-center transition"
            >
              <XCircle className="w-5 h-5 text-slate-400" />
            </button>
          </div>
        </div>

        {/* Modal Body */}
        <div className="p-6 overflow-y-auto max-h-[60vh]">
          {/* Meta Info */}
          <div className="grid grid-cols-3 gap-4 mb-6">
            <div className="bg-slate-800/50 rounded-lg p-4">
              <div className="flex items-center gap-2 mb-2">
                <UserCircle className="w-4 h-4 text-slate-500" />
                <span className="text-xs text-slate-500 uppercase tracking-wider">Actor</span>
              </div>
              <p className="font-medium">{step.actor}</p>
            </div>
            <div className="bg-slate-800/50 rounded-lg p-4">
              <div className="flex items-center gap-2 mb-2">
                <Settings className="w-4 h-4 text-slate-500" />
                <span className="text-xs text-slate-500 uppercase tracking-wider">System</span>
              </div>
              <p className="font-medium">{step.system}</p>
            </div>
            <div className="bg-slate-800/50 rounded-lg p-4">
              <div className="flex items-center gap-2 mb-2">
                <Clock className="w-4 h-4 text-slate-500" />
                <span className="text-xs text-slate-500 uppercase tracking-wider">Timing</span>
              </div>
              <p className="font-medium">{step.timing}</p>
            </div>
          </div>

          {/* Extended Description */}
          {step.extendedDescription && (
            <div className="mb-6">
              <h4 className="text-sm font-semibold text-slate-300 mb-3 flex items-center gap-2">
                <Zap className="w-4 h-4 text-amber-400" />
                What Happens
              </h4>
              <p className="text-slate-400 leading-relaxed">{step.extendedDescription}</p>
            </div>
          )}

          {/* Details/Bullet Points */}
          {step.details && step.details.length > 0 && (
            <div className="mb-6">
              <h4 className="text-sm font-semibold text-slate-300 mb-3 flex items-center gap-2">
                <CheckCircle className="w-4 h-4 text-green-400" />
                Key Details
              </h4>
              <div className="bg-slate-800/50 rounded-lg p-4">
                <ul className="space-y-2">
                  {step.details.map((detail, i) => (
                    <li key={i} className="flex items-start gap-3 text-slate-400">
                      <ChevronRight className="w-4 h-4 text-amber-400 flex-shrink-0 mt-0.5" />
                      <span>{detail}</span>
                    </li>
                  ))}
                </ul>
              </div>
            </div>
          )}

          {/* Technical Notes */}
          {step.technicalNotes && (
            <div className="mb-6">
              <h4 className="text-sm font-semibold text-slate-300 mb-3 flex items-center gap-2">
                <Settings className="w-4 h-4 text-blue-400" />
                Technical Notes
              </h4>
              <div className="bg-blue-500/10 border border-blue-500/20 rounded-lg p-4">
                <p className="text-sm text-slate-400">{step.technicalNotes}</p>
              </div>
            </div>
          )}

          {/* Integration Points */}
          {step.integrations && step.integrations.length > 0 && (
            <div className="mb-6">
              <h4 className="text-sm font-semibold text-slate-300 mb-3 flex items-center gap-2">
                <Zap className="w-4 h-4 text-purple-400" />
                Integration Points
              </h4>
              <div className="flex flex-wrap gap-2">
                {step.integrations.map((integration, i) => (
                  <span key={i} className="px-3 py-1.5 bg-purple-500/20 border border-purple-500/30 rounded-lg text-sm text-purple-300">
                    {integration}
                  </span>
                ))}
              </div>
            </div>
          )}

          {/* Error Handling */}
          {step.errorHandling && (
            <div className="mb-6">
              <h4 className="text-sm font-semibold text-slate-300 mb-3 flex items-center gap-2">
                <AlertTriangle className="w-4 h-4 text-amber-400" />
                Error Handling
              </h4>
              <div className="bg-amber-500/10 border border-amber-500/20 rounded-lg p-4">
                <p className="text-sm text-slate-400">{step.errorHandling}</p>
              </div>
            </div>
          )}

          {/* Success Criteria */}
          {step.successCriteria && (
            <div>
              <h4 className="text-sm font-semibold text-slate-300 mb-3 flex items-center gap-2">
                <Target className="w-4 h-4 text-green-400" />
                Success Criteria
              </h4>
              <div className="bg-green-500/10 border border-green-500/20 rounded-lg p-4">
                <p className="text-sm text-slate-400">{step.successCriteria}</p>
              </div>
            </div>
          )}
        </div>

        {/* Modal Footer */}
        <div className="p-4 border-t border-slate-800 bg-slate-900/50 flex items-center justify-between">
          <p className="text-xs text-slate-500">Click outside or press ESC to close</p>
          <button 
            onClick={onClose}
            className="px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-sm font-medium transition"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  );
}

function FlowStep({ step, title, description, actor, system, timing, color, details, isLast, compact, onStepClick, extendedDescription, technicalNotes, integrations, errorHandling, successCriteria }) {
  const colorClasses = {
    blue: 'bg-blue-500/20 border-blue-500/30 text-blue-400 hover:bg-blue-500/30',
    purple: 'bg-purple-500/20 border-purple-500/30 text-purple-400 hover:bg-purple-500/30',
    green: 'bg-green-500/20 border-green-500/30 text-green-400 hover:bg-green-500/30',
    amber: 'bg-amber-500/20 border-amber-500/30 text-amber-400 hover:bg-amber-500/30',
    red: 'bg-red-500/20 border-red-500/30 text-red-400 hover:bg-red-500/30',
  };

  const handleClick = () => {
    if (onStepClick) {
      onStepClick({
        step,
        title,
        description,
        actor,
        system,
        timing,
        color,
        details,
        extendedDescription,
        technicalNotes,
        integrations,
        errorHandling,
        successCriteria,
      });
    }
  };

  return (
    <div className={`flex gap-4 ${compact ? '' : ''}`}>
      {/* Step Number - Clickable */}
      <button 
        onClick={handleClick}
        className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 border-2 transition-all cursor-pointer ${colorClasses[color]}`}
        title="Click for details"
      >
        <span className="font-bold">{step}</span>
      </button>
      
      {/* Content - Clickable */}
      <div 
        className={`flex-1 ${compact ? 'pb-2' : 'pb-4'} cursor-pointer group`}
        onClick={handleClick}
      >
        <div className="flex items-start justify-between">
          <div>
            <h4 className="font-semibold group-hover:text-amber-400 transition-colors flex items-center gap-2">
              {title}
              <Eye className="w-3 h-3 text-slate-600 group-hover:text-amber-400 transition-colors" />
            </h4>
            <p className="text-sm text-slate-400 mt-1">{description}</p>
          </div>
          <div className="text-right text-xs text-slate-500 flex-shrink-0 ml-4">
            <p>{actor}</p>
            <p className="text-slate-600">{system}</p>
            <p className="text-slate-600">{timing}</p>
          </div>
        </div>
        
        {details && (
          <div className="mt-3 bg-slate-800/50 rounded-lg p-3 group-hover:bg-slate-800/70 transition-colors">
            <ul className="text-sm text-slate-400 space-y-1">
              {details.map((detail, i) => (
                <li key={i} className="flex items-start gap-2">
                  <span className="text-slate-600">•</span>
                  {detail}
                </li>
              ))}
            </ul>
          </div>
        )}
      </div>
    </div>
  );
}

function FlowConnector({ compact }) {
  return (
    <div className={`ml-5 border-l-2 border-dashed border-slate-700 ${compact ? 'h-4' : 'h-6'}`} />
  );
}

function DecisionPoint({ title, condition, outcomes }) {
  return (
    <div className="bg-slate-800/50 rounded-lg p-4 border border-slate-700">
      <div className="flex items-center gap-2 mb-2">
        <div className="w-6 h-6 bg-amber-500/20 rounded flex items-center justify-center">
          <span className="text-amber-400 text-xs">?</span>
        </div>
        <h5 className="font-medium">{title}</h5>
      </div>
      <p className="text-xs text-slate-500 mb-2">{condition}</p>
      <ul className="text-sm text-slate-400 space-y-1">
        {outcomes.map((outcome, i) => (
          <li key={i} className="text-xs">→ {outcome}</li>
        ))}
      </ul>
    </div>
  );
}

function DataFlowNode({ label, type }) {
  const typeClasses = {
    external: 'bg-slate-700 border-slate-600',
    platform: 'bg-blue-500/20 border-blue-500/30',
    axis: 'bg-amber-500/20 border-amber-500/30',
  };
  
  return (
    <div className={`px-4 py-3 rounded-lg border text-center ${typeClasses[type]}`}>
      <p className="text-sm font-medium">{label}</p>
    </div>
  );
}

function DataFlowArrow({ label }) {
  return (
    <div className="flex flex-col items-center gap-1">
      <p className="text-xs text-slate-500">{label}</p>
      <ChevronRight className="w-5 h-5 text-slate-600" />
    </div>
  );
}

function TriggerCard({ trigger, description, timing }) {
  return (
    <div className="bg-slate-800/50 rounded-lg p-4 border border-slate-700">
      <h5 className="font-medium text-amber-400">{trigger}</h5>
      <p className="text-sm text-slate-400 mt-1">{description}</p>
      <p className="text-xs text-slate-500 mt-2">{timing}</p>
    </div>
  );
}

function EntitySettlementCard({ type, method, timing, details }) {
  return (
    <div className="bg-slate-800/50 rounded-lg p-4 border border-slate-700">
      <h5 className="font-medium text-amber-400">{type}</h5>
      <p className="text-sm text-green-400 mt-1">{method}</p>
      <p className="text-xs text-slate-500">{timing}</p>
      <ul className="mt-3 text-xs text-slate-400 space-y-1">
        {details.map((detail, i) => (
          <li key={i}>• {detail}</li>
        ))}
      </ul>
    </div>
  );
}

function SuspensionTrigger({ trigger, description, action, reversible, configurable }) {
  return (
    <div className="bg-slate-800/50 rounded-lg p-4 border border-slate-700">
      <div className="flex items-center justify-between mb-2">
        <h5 className="font-medium text-red-400">{trigger}</h5>
        {configurable && <span className="text-xs bg-slate-700 px-2 py-0.5 rounded">Configurable</span>}
      </div>
      <p className="text-sm text-slate-400">{description}</p>
      <div className="mt-3 pt-3 border-t border-slate-700">
        <p className="text-xs text-slate-500"><span className="text-slate-400">Action:</span> {action}</p>
        <p className="text-xs text-slate-500 mt-1"><span className="text-slate-400">Reversible:</span> {reversible}</p>
      </div>
    </div>
  );
}

function WaterfallBar({ label, value, height, color, isDeduction, isFinal }) {
  const colorClasses = {
    slate: 'bg-slate-600',
    green: 'bg-green-500',
    red: 'bg-red-500/50',
    amber: 'bg-amber-500',
    purple: 'bg-purple-500',
    blue: 'bg-blue-500',
  };
  
  return (
    <div className="flex flex-col items-center">
      <div className="h-48 flex flex-col justify-end">
        <div 
          className={`w-16 ${colorClasses[color]} rounded-t ${isFinal ? 'ring-2 ring-green-400' : ''}`} 
          style={{ height: `${Math.abs(height) * 1.5}px` }}
        />
      </div>
      <p className="text-xs text-slate-500 mt-2 text-center">{label}</p>
      <p className={`text-sm font-bold ${isFinal ? 'text-green-400' : isDeduction ? 'text-green-400' : ''}`}>
        {isDeduction ? '' : '$'}{value.toFixed(2)}
      </p>
    </div>
  );
}

function ScoreWeightCard({ component, weight, metrics, color }) {
  const colorClasses = {
    red: 'border-red-500/30 bg-red-500/10',
    green: 'border-green-500/30 bg-green-500/10',
    blue: 'border-blue-500/30 bg-blue-500/10',
    purple: 'border-purple-500/30 bg-purple-500/10',
  };
  
  return (
    <div className={`rounded-lg border p-4 ${colorClasses[color]}`}>
      <div className="flex items-center justify-between mb-2">
        <h5 className="font-medium">{component}</h5>
        <span className="text-2xl font-bold">{weight}%</span>
      </div>
      <ul className="text-xs text-slate-400 space-y-1">
        {metrics.map((metric, i) => (
          <li key={i}>• {metric}</li>
        ))}
      </ul>
    </div>
  );
}

function TierThresholdBar({ tier, range, rate, color }) {
  const colorClasses = {
    orange: 'bg-orange-500/30 border-orange-500/50 text-orange-400',
    slate: 'bg-slate-500/30 border-slate-500/50 text-slate-300',
    amber: 'bg-amber-500/30 border-amber-500/50 text-amber-400',
    purple: 'bg-purple-500/30 border-purple-500/50 text-purple-400',
  };
  
  return (
    <div className={`flex-1 mx-1 rounded-lg border p-4 text-center ${colorClasses[color]}`}>
      <h5 className="font-bold">{tier}</h5>
      <p className="text-sm opacity-70">{range}</p>
      <p className="text-lg font-bold mt-2">{rate}</p>
    </div>
  );
}

// ============ SUPPLIER DISCOUNTS ============
function SupplierDiscounts() {
  const [showAddModal, setShowAddModal] = useState(false);
  
  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold">Supplier Discounts</h1>
          <p className="text-slate-400 mt-1">Manage negotiated rates with fuel platforms</p>
        </div>
        <button 
          onClick={() => setShowAddModal(true)}
          className="flex items-center gap-2 px-4 py-2 bg-amber-500 text-slate-900 rounded-lg text-sm font-medium hover:bg-amber-400 transition"
        >
          <Plus className="w-4 h-4" />
          Add Discount
        </button>
      </div>

      {/* Confidentiality Notice */}
      <div className="bg-red-500/10 border border-red-500/20 rounded-lg p-4 flex items-start gap-3">
        <EyeOff className="w-5 h-5 text-red-400 flex-shrink-0 mt-0.5" />
        <div>
          <p className="text-red-400 font-medium">Confidential - Admin Only</p>
          <p className="text-sm text-slate-400 mt-1">These negotiated rates are hidden from all downstream users including franchises, drivers, and carriers. Only Mega Admin can view supplier costs.</p>
        </div>
      </div>

      {/* Discount Cards by Platform */}
      <div className="space-y-6">
        {/* EFS Discounts */}
        <div className="bg-slate-900 rounded-xl border border-slate-800">
          <div className="p-4 border-b border-slate-800 flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
                <span className="text-blue-400 font-bold text-sm">EFS</span>
              </div>
              <div>
                <h3 className="font-semibold">EFS Fleet Card</h3>
                <p className="text-xs text-slate-500">Contract expires: Dec 31, 2025</p>
              </div>
            </div>
            <button className="text-sm text-slate-400 hover:text-slate-200">
              <Edit2 className="w-4 h-4" />
            </button>
          </div>
          <div className="p-4">
            <div className="grid grid-cols-3 gap-4">
              <DiscountTile 
                network="In-Network" 
                fuelType="Diesel" 
                discount="$0.08/gal" 
                locations="Pilot, Flying J, TA, Petro"
              />
              <DiscountTile 
                network="In-Network" 
                fuelType="DEF" 
                discount="$0.04/gal" 
                locations="Pilot, Flying J, TA, Petro"
              />
              <DiscountTile 
                network="In-Network" 
                fuelType="Reefer" 
                discount="$0.06/gal" 
                locations="Pilot, Flying J"
              />
            </div>
            <div className="mt-4 pt-4 border-t border-slate-800">
              <p className="text-xs text-slate-500">Volume Tier Bonus: Additional $0.02/gal when monthly volume exceeds 50,000 gallons</p>
            </div>
          </div>
        </div>

        {/* Commdata Discounts */}
        <div className="bg-slate-900 rounded-xl border border-slate-800">
          <div className="p-4 border-b border-slate-800 flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center">
                <span className="text-green-400 font-bold text-xs">CMD</span>
              </div>
              <div>
                <h3 className="font-semibold">Commdata</h3>
                <p className="text-xs text-slate-500">Contract expires: Mar 15, 2026</p>
              </div>
            </div>
            <button className="text-sm text-slate-400 hover:text-slate-200">
              <Edit2 className="w-4 h-4" />
            </button>
          </div>
          <div className="p-4">
            <div className="grid grid-cols-3 gap-4">
              <DiscountTile 
                network="In-Network" 
                fuelType="Diesel" 
                discount="$0.07/gal" 
                locations="Love's, Sapp Bros, Kwick Trip"
              />
              <DiscountTile 
                network="In-Network" 
                fuelType="DEF" 
                discount="$0.03/gal" 
                locations="Love's, Sapp Bros"
              />
              <DiscountTile 
                network="Out-of-Network" 
                fuelType="Diesel" 
                discount="$0.02/gal" 
                locations="All other locations"
              />
            </div>
          </div>
        </div>

        {/* Relay Discounts */}
        <div className="bg-slate-900 rounded-xl border border-slate-800">
          <div className="p-4 border-b border-slate-800 flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center">
                <span className="text-purple-400 font-bold text-sm">RLY</span>
              </div>
              <div>
                <h3 className="font-semibold">Relay Payments</h3>
                <p className="text-xs text-slate-500">Contract expires: Jun 30, 2025</p>
              </div>
            </div>
            <button className="text-sm text-slate-400 hover:text-slate-200">
              <Edit2 className="w-4 h-4" />
            </button>
          </div>
          <div className="p-4">
            <div className="grid grid-cols-2 gap-4">
              <DiscountTile 
                network="Network-Wide" 
                fuelType="Diesel" 
                discount="$0.05/gal" 
                locations="All participating locations"
              />
              <DiscountTile 
                network="Network-Wide" 
                fuelType="DEF" 
                discount="$0.02/gal" 
                locations="All participating locations"
              />
            </div>
            <div className="mt-4 pt-4 border-t border-slate-800 bg-purple-500/5 -mx-4 -mb-4 px-4 py-3 rounded-b-xl">
              <p className="text-xs text-purple-300">💡 Relay primarily used for carrier fuel advances in Mega Logistics brokerage operations</p>
            </div>
          </div>
        </div>
      </div>

      {/* Discount Capture Report */}
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <h3 className="font-semibold mb-4">Discount Capture Analysis (MTD)</h3>
        <div className="grid grid-cols-4 gap-4">
          <div className="text-center">
            <p className="text-3xl font-bold text-green-400">94.2%</p>
            <p className="text-xs text-slate-500 mt-1">Capture Rate</p>
          </div>
          <div className="text-center">
            <p className="text-3xl font-bold text-slate-100">247,842</p>
            <p className="text-xs text-slate-500 mt-1">Total Gallons</p>
          </div>
          <div className="text-center">
            <p className="text-3xl font-bold text-amber-400">$17,348</p>
            <p className="text-xs text-slate-500 mt-1">Discounts Captured</p>
          </div>
          <div className="text-center">
            <p className="text-3xl font-bold text-red-400">$1,082</p>
            <p className="text-xs text-slate-500 mt-1">Discounts Missed</p>
          </div>
        </div>
      </div>
    </div>
  );
}

// ============ PRICING MODELS ============
function PricingModels({ showModal, setShowModal }) {
  const [selectedModel, setSelectedModel] = useState('tiered');
  
  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold">Pricing Models</h1>
          <p className="text-slate-400 mt-1">Configure how entities are charged for fuel</p>
        </div>
        <button 
          onClick={() => setShowModal(true)}
          className="flex items-center gap-2 px-4 py-2 bg-amber-500 text-slate-900 rounded-lg text-sm font-medium hover:bg-amber-400 transition"
        >
          <Plus className="w-4 h-4" />
          Create Model
        </button>
      </div>

      {/* Pricing Waterfall Visualization */}
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <h3 className="font-semibold mb-4">Pricing Hierarchy (Waterfall)</h3>
        <div className="flex items-stretch gap-4">
          <WaterfallLevel 
            level="1"
            title="Supplier Cost"
            subtitle="Negotiated discounts"
            example="$3.20/gal"
            color="red"
            visibility="Admin Only"
            icon={EyeOff}
          />
          <div className="flex items-center">
            <ChevronRight className="w-6 h-6 text-slate-600" />
          </div>
          <WaterfallLevel 
            level="2"
            title="Mega Base Price"
            subtitle="Your pricing to entities"
            example="$3.35/gal"
            color="amber"
            visibility="Admin Only"
            icon={EyeOff}
          />
          <div className="flex items-center">
            <ChevronRight className="w-6 h-6 text-slate-600" />
          </div>
          <WaterfallLevel 
            level="3"
            title="Entity Price"
            subtitle="What driver/carrier sees"
            example="$3.42/gal"
            color="green"
            visibility="Visible to Entity"
            icon={Eye}
          />
        </div>
      </div>

      {/* Active Pricing Models */}
      <div className="grid grid-cols-2 gap-6">
        <PricingModelCard 
          name="Tiered by Driver Score"
          type="tiered"
          assignedTo="Company Drivers (Default)"
          entities={187}
          isDefault={true}
          details={[
            { tier: 'Platinum (90+)', rate: 'Cost + 3%', drivers: 42 },
            { tier: 'Gold (80-89)', rate: 'Cost + 5%', drivers: 78 },
            { tier: 'Silver (70-79)', rate: 'Cost + 7%', drivers: 52 },
            { tier: 'Bronze (<70)', rate: 'Cost + 10%', drivers: 15 },
          ]}
        />
        
        <PricingModelCard 
          name="Owner-Operator Standard"
          type="cost_plus"
          assignedTo="Owner-Operators"
          entities={89}
          isDefault={false}
          details={[
            { label: 'Base Rate', value: 'Cost + 6%' },
            { label: 'DEF Rate', value: 'Cost + 4%' },
          ]}
        />
        
        <PricingModelCard 
          name="Franchise Ceiling"
          type="cost_plus"
          assignedTo="All Franchises"
          entities={12}
          isDefault={false}
          details={[
            { label: 'Max Rate', value: 'Cost + 8%' },
            { label: 'Note', value: 'Franchises set own rates below this' },
          ]}
        />
        
        <PricingModelCard 
          name="Per-Mile Program"
          type="per_mile"
          assignedTo="Select O/Os"
          entities={23}
          isDefault={false}
          details={[
            { label: 'Rate', value: '$0.54/mile' },
            { label: 'Basis', value: 'Dispatched miles' },
          ]}
        />
        
        <PricingModelCard 
          name="Carrier Fuel Advance"
          type="pump_discount"
          assignedTo="Mega Logistics Carriers"
          entities={33}
          isDefault={false}
          details={[
            { label: 'Rate', value: 'Pump - 2%' },
            { label: 'Advance Fee', value: '3% of advance' },
          ]}
        />
        
        <PricingModelCard 
          name="Fixed Rate Q1"
          type="fixed"
          assignedTo="Contract Drivers"
          entities={8}
          isDefault={false}
          details={[
            { label: 'Fixed Price', value: '$3.29/gal' },
            { label: 'Valid Until', value: 'Mar 31, 2025' },
          ]}
        />
      </div>

      {/* Driver Score Tiers Configuration */}
      <div className="bg-slate-900 rounded-xl border border-slate-800">
        <div className="p-4 border-b border-slate-800 flex items-center justify-between">
          <h3 className="font-semibold">Driver Score Tier Configuration</h3>
          <button className="text-sm text-amber-400 hover:text-amber-300 flex items-center gap-1">
            <Edit2 className="w-3 h-3" />
            Edit Tiers
          </button>
        </div>
        <div className="p-4">
          <div className="grid grid-cols-4 gap-4 mb-6">
            <ScoreTierCard tier="Platinum" range="90-100" color="purple" discount="Best" count={42} />
            <ScoreTierCard tier="Gold" range="80-89" color="amber" discount="Good" count={78} />
            <ScoreTierCard tier="Silver" range="70-79" color="slate" discount="Standard" count={52} />
            <ScoreTierCard tier="Bronze" range="0-69" color="orange" discount="Base" count={15} />
          </div>
          <div className="bg-slate-800/50 rounded-lg p-4">
            <h4 className="text-sm font-medium mb-3">Score Components</h4>
            <div className="grid grid-cols-4 gap-4">
              <ScoreComponent name="Safety" weight={40} source="HOS, Hard Braking, Speeding" />
              <ScoreComponent name="Fuel Efficiency" weight={25} source="MPG vs Fleet Avg, Idle %" />
              <ScoreComponent name="Reliability" weight={20} source="On-Time %, Load Accept Rate" />
              <ScoreComponent name="Tenure" weight={15} source="Months Active, Consistency" />
            </div>
            <p className="text-xs text-slate-500 mt-4">Score recalculates weekly (Sunday midnight). Tier changes trigger driver notification.</p>
          </div>
        </div>
      </div>

      {/* Create Model Modal */}
      {showModal && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
          <div className="bg-slate-900 rounded-xl border border-slate-800 w-full max-w-lg mx-4">
            <div className="p-4 border-b border-slate-800 flex items-center justify-between">
              <h3 className="font-semibold">Create Pricing Model</h3>
              <button onClick={() => setShowModal(false)} className="text-slate-400 hover:text-slate-200">
                <XCircle className="w-5 h-5" />
              </button>
            </div>
            <div className="p-4 space-y-4">
              <div>
                <label className="block text-sm text-slate-400 mb-2">Model Name</label>
                <input type="text" className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm" placeholder="e.g., Premium Driver Rate" />
              </div>
              <div>
                <label className="block text-sm text-slate-400 mb-2">Pricing Type</label>
                <div className="grid grid-cols-2 gap-2">
                  {['Fixed Rate', 'Pump Discount', 'Per-Mile', 'Cost-Plus', 'Tiered', 'Custom'].map((type) => (
                    <button 
                      key={type}
                      onClick={() => setSelectedModel(type.toLowerCase())}
                      className={`px-3 py-2 rounded-lg text-sm border transition ${
                        selectedModel === type.toLowerCase() 
                          ? 'bg-amber-500/20 border-amber-500 text-amber-400' 
                          : 'bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-600'
                      }`}
                    >
                      {type}
                    </button>
                  ))}
                </div>
              </div>
              <div>
                <label className="block text-sm text-slate-400 mb-2">Assign To</label>
                <select className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm">
                  <option>Company Drivers (All)</option>
                  <option>Owner-Operators (All)</option>
                  <option>Specific Franchise</option>
                  <option>Carriers (Brokerage)</option>
                  <option>Individual Entity</option>
                </select>
              </div>
            </div>
            <div className="p-4 border-t border-slate-800 flex justify-end gap-3">
              <button onClick={() => setShowModal(false)} className="px-4 py-2 text-sm text-slate-400 hover:text-slate-200">Cancel</button>
              <button className="px-4 py-2 bg-amber-500 text-slate-900 rounded-lg text-sm font-medium hover:bg-amber-400">Create Model</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

// ============ CARD MANAGEMENT ============
function CardManagement({ showModal, setShowModal, expandedCard, setExpandedCard }) {
  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold">Card Management</h1>
          <p className="text-slate-400 mt-1">Fuel card lifecycle and controls</p>
        </div>
        <div className="flex items-center gap-3">
          <div className="relative">
            <Search className="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-500" />
            <input 
              type="text" 
              placeholder="Search cards, drivers..." 
              className="pl-9 pr-4 py-2 bg-slate-800 border border-slate-700 rounded-lg text-sm w-64"
            />
          </div>
          <button className="flex items-center gap-2 px-4 py-2 bg-slate-800 rounded-lg text-sm hover:bg-slate-700">
            <Filter className="w-4 h-4" />
            Filter
          </button>
        </div>
      </div>

      {/* Automated Provisioning Banner */}
      <div className="bg-green-500/10 border border-green-500/20 rounded-lg p-4 flex items-center justify-between">
        <div className="flex items-center gap-3">
          <CheckCircle className="w-5 h-5 text-green-400" />
          <div>
            <p className="text-green-400 font-medium">Automated Provisioning Active</p>
            <p className="text-sm text-slate-400">Cards auto-issue when drivers complete onboarding → Ship to driver's terminal</p>
          </div>
        </div>
        <button className="text-sm text-slate-400 hover:text-slate-200">Configure →</button>
      </div>

      {/* Card Status Summary */}
      <div className="grid grid-cols-5 gap-4">
        <CardStatusTile status="Active" count={387} color="green" />
        <CardStatusTile status="Provisioned" count={18} color="blue" />
        <CardStatusTile status="Suspended" count={5} color="amber" />
        <CardStatusTile status="Terminated" count={2} color="red" />
        <CardStatusTile status="Pending Approval" count={3} color="purple" />
      </div>

      {/* Cards Table */}
      <div className="bg-slate-900 rounded-xl border border-slate-800">
        <div className="p-4 border-b border-slate-800 flex items-center justify-between">
          <h3 className="font-semibold">All Fuel Cards</h3>
          <div className="flex items-center gap-2 text-sm text-slate-400">
            <span>412 cards</span>
            <span className="text-slate-600">|</span>
            <button className="text-amber-400 hover:text-amber-300">Export CSV</button>
          </div>
        </div>
        <div className="overflow-x-auto">
          <table className="w-full text-sm">
            <thead>
              <tr className="text-left text-slate-500 border-b border-slate-800">
                <th className="px-4 py-3 font-medium">Card / Platform</th>
                <th className="px-4 py-3 font-medium">Entity</th>
                <th className="px-4 py-3 font-medium">Type</th>
                <th className="px-4 py-3 font-medium">Status</th>
                <th className="px-4 py-3 font-medium">Pricing Model</th>
                <th className="px-4 py-3 font-medium">Daily Limit</th>
                <th className="px-4 py-3 font-medium">MTD Spend</th>
                <th className="px-4 py-3 font-medium">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-slate-800">
              <CardRow 
                cardNumber="EFS-4521-8847"
                platform="EFS"
                entityName="Miguel Rodriguez"
                entityType="Company Driver"
                status="Active"
                pricingModel="Tiered (Gold)"
                dailyLimit={500}
                mtdSpend={2847}
                expanded={expandedCard === 1}
                onToggle={() => setExpandedCard(expandedCard === 1 ? null : 1)}
              />
              <CardRow 
                cardNumber="CMD-2293-1156"
                platform="Commdata"
                entityName="ABC Trucking LLC"
                entityType="Franchise"
                status="Active"
                pricingModel="Franchise Ceiling"
                dailyLimit={2500}
                mtdSpend={18422}
                expanded={expandedCard === 2}
                onToggle={() => setExpandedCard(expandedCard === 2 ? null : 2)}
              />
              <CardRow 
                cardNumber="RLY-8821-4492"
                platform="Relay"
                entityName="Swift Transport"
                entityType="Carrier"
                status="Active"
                pricingModel="Carrier Advance"
                dailyLimit={1000}
                mtdSpend={4218}
                expanded={expandedCard === 3}
                onToggle={() => setExpandedCard(expandedCard === 3 ? null : 3)}
              />
              <CardRow 
                cardNumber="EFS-6632-9918"
                platform="EFS"
                entityName="James Wilson"
                entityType="Owner-Operator"
                status="Suspended"
                pricingModel="O/O Standard"
                dailyLimit={500}
                mtdSpend={892}
                expanded={expandedCard === 4}
                onToggle={() => setExpandedCard(expandedCard === 4 ? null : 4)}
              />
            </tbody>
          </table>
        </div>
      </div>

      {/* Card Controls Default Settings */}
      <div className="bg-slate-900 rounded-xl border border-slate-800">
        <div className="p-4 border-b border-slate-800">
          <h3 className="font-semibold">Default Card Controls (Network-Level)</h3>
          <p className="text-sm text-slate-500 mt-1">Applied to new cards unless overridden</p>
        </div>
        <div className="p-4 grid grid-cols-3 gap-6">
          <div className="space-y-4">
            <h4 className="text-sm font-medium text-slate-400">Spending Limits</h4>
            <ControlSetting label="Daily Dollar Limit" value="$500" adjustable />
            <ControlSetting label="Transaction Limit" value="$300" adjustable />
            <ControlSetting label="Daily Gallon Limit" value="150 gal" adjustable />
          </div>
          <div className="space-y-4">
            <h4 className="text-sm font-medium text-slate-400">Product Restrictions</h4>
            <ControlToggle label="Diesel" enabled={true} />
            <ControlToggle label="DEF" enabled={true} />
            <ControlToggle label="Reefer Fuel" enabled={true} />
            <ControlToggle label="Cash Advances" enabled={false} />
          </div>
          <div className="space-y-4">
            <h4 className="text-sm font-medium text-slate-400">Security</h4>
            <ControlSetting label="Network" value="In-Network Only" adjustable />
            <ControlSetting label="Odometer Prompt" value="Required" locked />
            <ControlSetting label="Driver ID Required" value="Yes" locked />
          </div>
        </div>
      </div>
    </div>
  );
}

// ============ FRANCHISE ADMIN VIEW ============
function FranchiseAdmin() {
  return (
    <div className="space-y-6">
      {/* View Indicator */}
      <div className="bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 flex items-center gap-3">
        <Building2 className="w-5 h-5 text-blue-400" />
        <span className="text-blue-400 text-sm">Viewing as: <strong>ABC Trucking LLC</strong> (Franchise Admin)</span>
      </div>

      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold">Franchise Fuel Management</h1>
          <p className="text-slate-400 mt-1">Manage pricing for your fleet drivers</p>
        </div>
      </div>

      {/* Franchise Cost Ceiling */}
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <div className="flex items-center justify-between mb-4">
          <h3 className="font-semibold">Your Assigned Rate from Mega</h3>
          <span className="text-xs bg-amber-500/20 text-amber-400 px-2 py-1 rounded">Your Cost Ceiling</span>
        </div>
        <div className="grid grid-cols-3 gap-4">
          <div className="bg-slate-800/50 rounded-lg p-4">
            <p className="text-xs text-slate-500 uppercase tracking-wider">Diesel</p>
            <p className="text-2xl font-bold text-slate-100 mt-1">Cost + 8%</p>
            <p className="text-xs text-slate-500 mt-1">≈ $3.42/gal today</p>
          </div>
          <div className="bg-slate-800/50 rounded-lg p-4">
            <p className="text-xs text-slate-500 uppercase tracking-wider">DEF</p>
            <p className="text-2xl font-bold text-slate-100 mt-1">Cost + 6%</p>
            <p className="text-xs text-slate-500 mt-1">≈ $2.89/gal today</p>
          </div>
          <div className="bg-slate-800/50 rounded-lg p-4">
            <p className="text-xs text-slate-500 uppercase tracking-wider">Reefer</p>
            <p className="text-2xl font-bold text-slate-100 mt-1">Cost + 8%</p>
            <p className="text-xs text-slate-500 mt-1">≈ $3.58/gal today</p>
          </div>
        </div>
        <p className="text-xs text-slate-500 mt-4">You can set driver pricing at or above these rates. Supplier costs are not visible.</p>
      </div>

      {/* Franchise Pricing to Drivers */}
      <div className="bg-slate-900 rounded-xl border border-slate-800">
        <div className="p-4 border-b border-slate-800 flex items-center justify-between">
          <h3 className="font-semibold">Your Pricing to Drivers</h3>
          <button className="flex items-center gap-2 px-3 py-1.5 bg-amber-500 text-slate-900 rounded-lg text-sm font-medium hover:bg-amber-400">
            <Edit2 className="w-3 h-3" />
            Edit Pricing
          </button>
        </div>
        <div className="p-4">
          <div className="grid grid-cols-3 gap-4 mb-4">
            <div className="bg-green-500/10 border border-green-500/20 rounded-lg p-4">
              <p className="text-xs text-slate-500 uppercase tracking-wider">Your Driver Rate</p>
              <p className="text-2xl font-bold text-green-400 mt-1">Cost + 11%</p>
              <p className="text-xs text-slate-500 mt-1">≈ $3.52/gal to drivers</p>
            </div>
            <div className="bg-green-500/10 border border-green-500/20 rounded-lg p-4">
              <p className="text-xs text-slate-500 uppercase tracking-wider">Your Margin</p>
              <p className="text-2xl font-bold text-green-400 mt-1">3%</p>
              <p className="text-xs text-slate-500 mt-1">$0.10/gal spread</p>
            </div>
            <div className="bg-slate-800/50 rounded-lg p-4">
              <p className="text-xs text-slate-500 uppercase tracking-wider">MTD Revenue</p>
              <p className="text-2xl font-bold text-slate-100 mt-1">$1,247</p>
              <p className="text-xs text-slate-500 mt-1">From fuel margin</p>
            </div>
          </div>
          
          {/* Driver Visibility Preview */}
          <div className="bg-slate-800/30 rounded-lg p-4 border border-dashed border-slate-700">
            <p className="text-xs text-slate-500 mb-2">👁️ What your drivers see:</p>
            <div className="bg-slate-900 rounded-lg p-3 inline-block">
              <p className="text-sm text-slate-400">Your Fuel Price</p>
              <p className="text-xl font-bold text-slate-100">$3.52<span className="text-sm text-slate-400">/gal</span></p>
            </div>
          </div>
        </div>
      </div>

      {/* Franchise Drivers */}
      <div className="bg-slate-900 rounded-xl border border-slate-800">
        <div className="p-4 border-b border-slate-800 flex items-center justify-between">
          <h3 className="font-semibold">Your Fleet Drivers</h3>
          <span className="text-sm text-slate-400">24 active cards</span>
        </div>
        <div className="divide-y divide-slate-800">
          <FranchiseDriverRow name="Carlos Martinez" truck="ABC-101" mtdGallons={842} mtdSpend={2963} status="Active" />
          <FranchiseDriverRow name="David Kim" truck="ABC-102" mtdGallons={728} mtdSpend={2562} status="Active" />
          <FranchiseDriverRow name="Roberto Silva" truck="ABC-103" mtdGallons={691} mtdSpend={2432} status="Active" />
        </div>
      </div>

      {/* Weekly Invoice Preview */}
      <div className="bg-slate-900 rounded-xl border border-slate-800">
        <div className="p-4 border-b border-slate-800 flex items-center justify-between">
          <h3 className="font-semibold">Weekly Invoice Preview</h3>
          <span className="text-xs bg-blue-500/20 text-blue-400 px-2 py-1 rounded">Invoiced Weekly</span>
        </div>
        <div className="p-4">
          <div className="flex items-center justify-between mb-4">
            <span className="text-slate-400">Current Week (Dec 9-15)</span>
            <span className="text-xl font-bold">$8,422.18</span>
          </div>
          <div className="space-y-2 text-sm">
            <div className="flex justify-between text-slate-400">
              <span>Diesel (2,184 gal)</span>
              <span>$7,467.48</span>
            </div>
            <div className="flex justify-between text-slate-400">
              <span>DEF (248 gal)</span>
              <span>$716.72</span>
            </div>
            <div className="flex justify-between text-slate-400">
              <span>Reefer (67 gal)</span>
              <span>$237.98</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

// ============ DRIVER APP VIEW ============
function DriverApp({ driverView, setDriverView }) {
  return (
    <div className="max-w-sm mx-auto">
      <div className="bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 flex items-center gap-3 mb-6">
        <Smartphone className="w-5 h-5 text-blue-400" />
        <span className="text-blue-400 text-sm">Driver Mobile App Preview</span>
      </div>

      {/* Phone Frame */}
      <div className="bg-slate-950 rounded-[2.5rem] p-3 border-4 border-slate-800 shadow-2xl">
        <div className="bg-slate-900 rounded-[2rem] overflow-hidden">
          {/* Status Bar */}
          <div className="bg-slate-900 px-6 py-2 flex items-center justify-between text-xs text-slate-400">
            <span>9:41</span>
            <div className="flex items-center gap-1">
              <div className="w-4 h-2 border border-slate-400 rounded-sm">
                <div className="w-3 h-1.5 bg-green-400 rounded-sm" />
              </div>
            </div>
          </div>

          {/* App Header */}
          <div className="bg-slate-800 px-4 py-3 flex items-center justify-between">
            <div className="flex items-center gap-2">
              <div className="w-6 h-6 bg-amber-500 rounded flex items-center justify-center">
                <Zap className="w-4 h-4 text-slate-900" />
              </div>
              <span className="font-semibold text-sm">AXIS Fuel</span>
            </div>
            <Bell className="w-5 h-5 text-slate-400" />
          </div>

          {/* Driver Info */}
          <div className="px-4 py-3 bg-gradient-to-r from-amber-500/20 to-orange-500/10 border-b border-slate-800">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-slate-700 rounded-full flex items-center justify-center">
                <UserCircle className="w-6 h-6 text-slate-400" />
              </div>
              <div>
                <p className="font-medium text-sm">Miguel Rodriguez</p>
                <div className="flex items-center gap-2 mt-0.5">
                  <span className="text-xs bg-amber-500/30 text-amber-300 px-1.5 py-0.5 rounded">Gold Tier</span>
                  <span className="text-xs text-slate-500">Score: 84</span>
                </div>
              </div>
            </div>
          </div>

          {/* Tab Navigation */}
          <div className="flex border-b border-slate-800">
            {[
              { id: 'fuel-stops', label: 'Fuel Stops', icon: MapPin },
              { id: 'my-card', label: 'My Card', icon: CreditCard },
              { id: 'history', label: 'History', icon: Clock },
            ].map((tab) => (
              <button
                key={tab.id}
                onClick={() => setDriverView(tab.id)}
                className={`flex-1 py-3 text-xs font-medium flex flex-col items-center gap-1 transition ${
                  driverView === tab.id ? 'text-amber-400 border-b-2 border-amber-400' : 'text-slate-500'
                }`}
              >
                <tab.icon className="w-4 h-4" />
                {tab.label}
              </button>
            ))}
          </div>

          {/* Content Area */}
          <div className="h-[480px] overflow-y-auto">
            {driverView === 'fuel-stops' && (
              <div className="p-4 space-y-4">
                {/* Push Notification Preview */}
                <div className="bg-green-500/10 border border-green-500/30 rounded-xl p-3">
                  <div className="flex items-start gap-2">
                    <Navigation className="w-4 h-4 text-green-400 mt-0.5" />
                    <div>
                      <p className="text-xs font-medium text-green-400">Recommended Fuel Stop</p>
                      <p className="text-xs text-slate-400 mt-0.5">Pilot #4521 - 47 miles ahead</p>
                    </div>
                  </div>
                </div>

                {/* Recommended Stop Card */}
                <div className="bg-slate-800 rounded-xl overflow-hidden">
                  <div className="bg-gradient-to-r from-green-500/20 to-emerald-500/10 px-4 py-2 flex items-center justify-between">
                    <span className="text-xs font-medium text-green-400">⭐ Best Option</span>
                    <span className="text-xs text-slate-500">Save $23.40</span>
                  </div>
                  <div className="p-4">
                    <div className="flex items-start justify-between">
                      <div>
                        <h4 className="font-semibold">Pilot #4521</h4>
                        <p className="text-xs text-slate-500 mt-0.5">Dallas, TX • 47 mi ahead</p>
                      </div>
                      <div className="text-right">
                        <p className="text-lg font-bold text-green-400">$3.24</p>
                        <p className="text-xs text-slate-500">/gal</p>
                      </div>
                    </div>
                    <div className="mt-3 pt-3 border-t border-slate-700 grid grid-cols-3 gap-2 text-center text-xs">
                      <div>
                        <p className="text-slate-500">ETA</p>
                        <p className="font-medium">2:15 PM</p>
                      </div>
                      <div>
                        <p className="text-slate-500">Detour</p>
                        <p className="font-medium">12 min</p>
                      </div>
                      <div>
                        <p className="text-slate-500">DEF</p>
                        <p className="font-medium text-green-400">$2.84</p>
                      </div>
                    </div>
                    <button className="w-full mt-3 py-2.5 bg-amber-500 text-slate-900 rounded-lg text-sm font-medium">
                      Navigate
                    </button>
                  </div>
                </div>

                {/* Alternative Stops */}
                <div>
                  <p className="text-xs text-slate-500 mb-2">Other Options</p>
                  <div className="space-y-2">
                    <AlternativeStop name="Love's #847" distance="62 mi" price={3.31} detour="8 min" />
                    <AlternativeStop name="TA #192" distance="78 mi" price={3.28} detour="15 min" />
                  </div>
                </div>
              </div>
            )}

            {driverView === 'my-card' && (
              <div className="p-4 space-y-4">
                {/* Virtual Card */}
                <div className="bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl p-4 border border-slate-700">
                  <div className="flex items-center justify-between mb-6">
                    <span className="text-xs text-slate-500">EFS Fleet Card</span>
                    <div className="w-8 h-5 bg-blue-500/30 rounded flex items-center justify-center">
                      <span className="text-[8px] text-blue-400 font-bold">EFS</span>
                    </div>
                  </div>
                  <p className="font-mono text-lg tracking-widest mb-4">•••• •••• •••• 8847</p>
                  <div className="flex items-center justify-between text-xs">
                    <div>
                      <p className="text-slate-500">Cardholder</p>
                      <p className="font-medium">Miguel Rodriguez</p>
                    </div>
                    <div className="text-right">
                      <p className="text-slate-500">Status</p>
                      <p className="font-medium text-green-400">Active</p>
                    </div>
                  </div>
                </div>

                {/* Today's Pricing */}
                <div className="bg-slate-800 rounded-xl p-4">
                  <h4 className="text-sm font-medium mb-3">Your Pricing Today</h4>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between">
                      <span className="text-slate-400 text-sm">Diesel</span>
                      <span className="font-bold">$3.28<span className="text-xs text-slate-500">/gal</span></span>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-slate-400 text-sm">DEF</span>
                      <span className="font-bold">$2.76<span className="text-xs text-slate-500">/gal</span></span>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-slate-400 text-sm">Reefer</span>
                      <span className="font-bold">$3.41<span className="text-xs text-slate-500">/gal</span></span>
                    </div>
                  </div>
                  <div className="mt-3 pt-3 border-t border-slate-700">
                    <p className="text-xs text-slate-500">Gold Tier pricing • Score: 84</p>
                    <p className="text-xs text-amber-400 mt-1">+6 points to reach Platinum!</p>
                  </div>
                </div>

                {/* Limits */}
                <div className="bg-slate-800 rounded-xl p-4">
                  <h4 className="text-sm font-medium mb-3">Daily Limits</h4>
                  <div className="space-y-3">
                    <LimitBar label="Spending" used={287} limit={500} />
                    <LimitBar label="Gallons" used={84} limit={150} />
                  </div>
                </div>
              </div>
            )}

            {driverView === 'history' && (
              <div className="p-4 space-y-4">
                <div className="bg-slate-800 rounded-xl p-4">
                  <h4 className="text-sm font-medium mb-1">December 2024</h4>
                  <div className="flex items-baseline gap-2">
                    <span className="text-2xl font-bold">$847.24</span>
                    <span className="text-xs text-slate-500">258 gallons</span>
                  </div>
                </div>

                <div className="space-y-2">
                  <p className="text-xs text-slate-500">Recent Transactions</p>
                  <DriverTransaction location="Pilot #4521" city="Dallas, TX" gallons={127} amount={416.56} time="Today, 2:32 PM" type="Diesel" />
                  <DriverTransaction location="Love's #293" city="Amarillo, TX" gallons={98} amount={321.44} time="Yesterday" type="Diesel" />
                  <DriverTransaction location="TA #847" city="Oklahoma City" gallons={12} amount={33.12} time="Yesterday" type="DEF" />
                  <DriverTransaction location="Flying J #112" city="Little Rock, AR" gallons={142} amount={466.12} time="Dec 10" type="Diesel" />
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}

// ============ FUEL OPTIMIZER ============
function FuelOptimizer() {
  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold">Smart Fuel Stop Optimizer</h1>
          <p className="text-slate-400 mt-1">Route-optimized fuel recommendations integrated with dispatch</p>
        </div>
      </div>

      {/* How It Works */}
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <h3 className="font-semibold mb-4">Optimization Logic</h3>
        <div className="grid grid-cols-5 gap-4">
          <OptimizationStep 
            step={1}
            title="Fuel Need"
            description="Calculate fuel required with 15% reserve"
            icon={Gauge}
          />
          <OptimizationStep 
            step={2}
            title="Station Filter"
            description="Identify in-network stops along route"
            icon={MapPin}
          />
          <OptimizationStep 
            step={3}
            title="Feasibility Check"
            description="Verify ETA and HOS compliance"
            icon={Clock}
          />
          <OptimizationStep 
            step={4}
            title="Cost Score"
            description="Rank by total cost efficiency"
            icon={DollarSign}
          />
          <OptimizationStep 
            step={5}
            title="Push to Driver"
            description="Send recommendation via app + notification"
            icon={Smartphone}
          />
        </div>
      </div>

      {/* Active Load Example */}
      <div className="bg-slate-900 rounded-xl border border-slate-800">
        <div className="p-4 border-b border-slate-800 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <Truck className="w-5 h-5 text-amber-400" />
            <div>
              <h3 className="font-semibold">Load #4521-DFW</h3>
              <p className="text-xs text-slate-500">Dallas → Miami • T-2847 • Miguel Rodriguez</p>
            </div>
          </div>
          <span className="text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded">In Transit</span>
        </div>
        <div className="p-4">
          <div className="grid grid-cols-4 gap-4 mb-6">
            <div className="bg-slate-800/50 rounded-lg p-3">
              <p className="text-xs text-slate-500">Current Fuel</p>
              <p className="text-lg font-bold">42%</p>
              <p className="text-xs text-slate-500">~180 mi range</p>
            </div>
            <div className="bg-slate-800/50 rounded-lg p-3">
              <p className="text-xs text-slate-500">Miles Remaining</p>
              <p className="text-lg font-bold">847 mi</p>
            </div>
            <div className="bg-slate-800/50 rounded-lg p-3">
              <p className="text-xs text-slate-500">Delivery ETA</p>
              <p className="text-lg font-bold">Dec 14</p>
              <p className="text-xs text-slate-500">10:00 AM</p>
            </div>
            <div className="bg-slate-800/50 rounded-lg p-3">
              <p className="text-xs text-slate-500">HOS Remaining</p>
              <p className="text-lg font-bold">6.5 hrs</p>
            </div>
          </div>

          {/* Route Map Placeholder */}
          <div className="bg-slate-800 rounded-lg h-48 flex items-center justify-center border border-slate-700 mb-4">
            <div className="text-center">
              <MapPin className="w-8 h-8 text-slate-600 mx-auto mb-2" />
              <p className="text-sm text-slate-500">Interactive Route Map</p>
              <p className="text-xs text-slate-600">Showing fuel stops along Dallas → Miami route</p>
            </div>
          </div>

          {/* Recommended Stops */}
          <h4 className="text-sm font-medium mb-3">Recommended Fuel Stops</h4>
          <div className="space-y-3">
            <FuelStopRecommendation 
              rank={1}
              name="Pilot #4521"
              city="Shreveport, LA"
              distance={142}
              price={3.24}
              savings={23.40}
              detour={12}
              status="Primary"
            />
            <FuelStopRecommendation 
              rank={2}
              name="Love's #293"
              city="Jackson, MS"
              distance={347}
              price={3.28}
              savings={18.20}
              detour={8}
              status="Secondary"
            />
          </div>
        </div>
      </div>

      {/* Optimization Effectiveness */}
      <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
        <h3 className="font-semibold mb-4">Optimization Effectiveness (MTD)</h3>
        <div className="grid grid-cols-4 gap-4">
          <div className="text-center">
            <p className="text-3xl font-bold text-green-400">78%</p>
            <p className="text-xs text-slate-500 mt-1">Recommendations Followed</p>
          </div>
          <div className="text-center">
            <p className="text-3xl font-bold text-amber-400">$12,847</p>
            <p className="text-xs text-slate-500 mt-1">Est. Savings Captured</p>
          </div>
          <div className="text-center">
            <p className="text-3xl font-bold text-slate-100">1,247</p>
            <p className="text-xs text-slate-500 mt-1">Recommendations Sent</p>
          </div>
          <div className="text-center">
            <p className="text-3xl font-bold text-blue-400">14 min</p>
            <p className="text-xs text-slate-500 mt-1">Avg Detour Time</p>
          </div>
        </div>
      </div>
    </div>
  );
}

// ============ REPORTS ============
function Reports() {
  const [activeReport, setActiveReport] = useState('margin');
  
  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold">Reports & Analytics</h1>
          <p className="text-slate-400 mt-1">Fuel program insights and IFTA compliance</p>
        </div>
        <button className="flex items-center gap-2 px-4 py-2 bg-amber-500 text-slate-900 rounded-lg text-sm font-medium hover:bg-amber-400">
          <Download className="w-4 h-4" />
          Export All
        </button>
      </div>

      {/* Report Tabs */}
      <div className="flex gap-2 border-b border-slate-800 pb-2">
        {[
          { id: 'margin', label: 'Margin Analysis' },
          { id: 'mpg', label: 'MPG Fleet Analysis' },
          { id: 'fraud', label: 'Fraud Detection' },
          { id: 'ifta', label: 'IFTA Summary' },
          { id: 'franchise', label: 'Franchise Audit' },
        ].map((tab) => (
          <button
            key={tab.id}
            onClick={() => setActiveReport(tab.id)}
            className={`px-4 py-2 rounded-lg text-sm font-medium transition ${
              activeReport === tab.id
                ? 'bg-amber-500/20 text-amber-400'
                : 'text-slate-400 hover:bg-slate-800'
            }`}
          >
            {tab.label}
          </button>
        ))}
      </div>

      {activeReport === 'margin' && (
        <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
          <h3 className="font-semibold mb-4">Margin Analysis by Entity Type</h3>
          <div className="space-y-4">
            <MarginRow entity="Company Drivers" gallons={127842} ourCost={408108} billed={457895} margin={49787} />
            <MarginRow entity="Owner-Operators" gallons={89421} ourCost={286148} billed={314763} margin={28615} />
            <MarginRow entity="Franchises" gallons={62184} ourCost={198989} billed={218867} margin={19878} />
            <MarginRow entity="Carriers (Brokerage)" gallons={18247} ourCost={58390} billed={62057} margin={3667} />
          </div>
          <div className="mt-6 pt-4 border-t border-slate-800 flex items-center justify-between">
            <span className="font-medium">Total Fuel Program Revenue (MTD)</span>
            <span className="text-2xl font-bold text-green-400">$101,947</span>
          </div>
        </div>
      )}

      {activeReport === 'ifta' && (
        <div className="bg-slate-900 rounded-xl border border-slate-800">
          <div className="p-4 border-b border-slate-800 flex items-center justify-between">
            <h3 className="font-semibold">IFTA Fuel Summary - Q4 2024</h3>
            <button className="text-sm text-amber-400 hover:text-amber-300">Download IFTA Report →</button>
          </div>
          <div className="overflow-x-auto">
            <table className="w-full text-sm">
              <thead>
                <tr className="text-left text-slate-500 border-b border-slate-800">
                  <th className="px-4 py-3 font-medium">State</th>
                  <th className="px-4 py-3 font-medium">Diesel (Gal)</th>
                  <th className="px-4 py-3 font-medium">DEF (Gal)</th>
                  <th className="px-4 py-3 font-medium">Reefer (Gal)</th>
                  <th className="px-4 py-3 font-medium">Total</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-slate-800">
                <IFTARow state="Texas" diesel={42847} def={4218} reefer={2847} />
                <IFTARow state="Florida" diesel={38421} def={3842} reefer={2421} />
                <IFTARow state="Louisiana" diesel={24218} def={2422} reefer={1218} />
                <IFTARow state="Mississippi" diesel={18942} def={1894} reefer={942} />
                <IFTARow state="Alabama" diesel={14218} def={1422} reefer={718} />
                <IFTARow state="Georgia" diesel={12847} def={1285} reefer={647} />
              </tbody>
            </table>
          </div>
        </div>
      )}

      {activeReport === 'fraud' && (
        <div className="space-y-4">
          <div className="bg-slate-900 rounded-xl border border-slate-800 p-6">
            <h3 className="font-semibold mb-4">Fraud Indicators</h3>
            <div className="grid grid-cols-4 gap-4">
              <FraudMetric label="Out-of-Route Purchases" count={7} trend="up" severity="warning" />
              <FraudMetric label="Unusual Volume" count={3} trend="down" severity="info" />
              <FraudMetric label="Duplicate Transactions" count={0} trend="same" severity="success" />
              <FraudMetric label="Velocity Flags" count={2} trend="up" severity="warning" />
            </div>
          </div>
          <div className="bg-slate-900 rounded-xl border border-slate-800">
            <div className="p-4 border-b border-slate-800">
              <h3 className="font-semibold">Flagged Transactions</h3>
            </div>
            <div className="divide-y divide-slate-800">
              <FraudRow 
                driver="James Wilson"
                issue="Out-of-route: 47 miles from assigned path"
                location="Shell #2847 - Abilene, TX"
                date="Dec 11"
                amount={287.42}
              />
              <FraudRow 
                driver="Unknown Card"
                issue="Unusual volume: 198 gal single transaction"
                location="Pilot #8821 - Memphis, TN"
                date="Dec 10"
                amount={648.24}
              />
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

// ============ SETTINGS ============
function SettingsView() {
  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold">Fuel Module Settings</h1>
        <p className="text-slate-400 mt-1">Configure thresholds, defaults, and automation rules</p>
      </div>

      {/* Auto-Suspension Settings */}
      <div className="bg-slate-900 rounded-xl border border-slate-800">
        <div className="p-4 border-b border-slate-800">
          <h3 className="font-semibold">Auto-Suspension Rules</h3>
          <p className="text-sm text-slate-500 mt-1">Cards automatically suspend when conditions are met</p>
        </div>
        <div className="p-4 space-y-4">
          <SettingRow 
            label="Driver Score Threshold"
            description="Suspend card when driver score falls below"
            value="50"
            type="number"
            editable
          />
          <SettingRow 
            label="Failed Drug Test"
            description="Auto-suspend on failed test result"
            value="Enabled"
            type="toggle"
            enabled
          />
          <SettingRow 
            label="Driver Inactive"
            description="Suspend when driver marked inactive in AXIS"
            value="Enabled"
            type="toggle"
            enabled
          />
          <SettingRow 
            label="Settlement Balance Exceeded"
            description="Suspend when balance exceeds threshold"
            value="$2,500"
            type="number"
            editable
          />
        </div>
      </div>

      {/* Fuel Advance Settings (Mega Logistics) */}
      <div className="bg-slate-900 rounded-xl border border-slate-800">
        <div className="p-4 border-b border-slate-800 flex items-center justify-between">
          <div>
            <h3 className="font-semibold">Fuel Advance Program</h3>
            <p className="text-sm text-slate-500 mt-1">For Mega Logistics carrier advances</p>
          </div>
          <div className="flex items-center gap-2">
            <span className="text-sm text-slate-400">Disabled for Mega Trucking</span>
            <ToggleLeft className="w-8 h-8 text-slate-600" />
          </div>
        </div>
        <div className="p-4 space-y-4 opacity-60">
          <SettingRow 
            label="Max Advance (%)"
            description="Maximum % of load value for fuel advance"
            value="50%"
            type="number"
          />
          <SettingRow 
            label="Advance Fee"
            description="Fee charged on fuel advances"
            value="3%"
            type="number"
          />
          <SettingRow 
            label="Auto-Recapture"
            description="Automatically deduct from settlement"
            value="Enabled"
            type="toggle"
            enabled
          />
        </div>
        <div className="px-4 pb-4">
          <div className="bg-purple-500/10 border border-purple-500/20 rounded-lg p-3">
            <p className="text-xs text-purple-300">💡 Enable this for Mega Logistics brokerage operations to offer carrier fuel advances via Relay</p>
          </div>
        </div>
      </div>

      {/* Card Provisioning */}
      <div className="bg-slate-900 rounded-xl border border-slate-800">
        <div className="p-4 border-b border-slate-800">
          <h3 className="font-semibold">Card Provisioning</h3>
        </div>
        <div className="p-4 space-y-4">
          <SettingRow 
            label="Auto-Issue on Onboarding"
            description="Automatically provision card when driver completes onboarding"
            value="Enabled"
            type="toggle"
            enabled
          />
          <SettingRow 
            label="Ship To"
            description="Where physical cards are shipped"
            value="Driver's Terminal"
            type="select"
            options={["Driver's Terminal", "Driver's Address", "Main Office"]}
          />
          <SettingRow 
            label="Default Platform"
            description="Platform for new company driver cards"
            value="EFS"
            type="select"
            options={["EFS", "Commdata", "Relay"]}
          />
        </div>
      </div>

      {/* Notification Settings */}
      <div className="bg-slate-900 rounded-xl border border-slate-800">
        <div className="p-4 border-b border-slate-800">
          <h3 className="font-semibold">Driver Notifications</h3>
        </div>
        <div className="p-4 space-y-4">
          <SettingRow 
            label="Fuel Stop Recommendations"
            description="Push notification + in-app display"
            value="Both"
            type="select"
            options={["Push Only", "In-App Only", "Both", "Disabled"]}
          />
          <SettingRow 
            label="Tier Change Alerts"
            description="Notify driver when pricing tier changes"
            value="Enabled"
            type="toggle"
            enabled
          />
          <SettingRow 
            label="Daily Limit Warning"
            description="Alert when approaching daily limit"
            value="80%"
            type="number"
          />
        </div>
      </div>
    </div>
  );
}

// ============ COMPONENT HELPERS ============

function KPICard({ title, value, change, period, icon: Icon, color }) {
  const colorClasses = {
    amber: 'bg-amber-500/10 text-amber-400',
    green: 'bg-green-500/10 text-green-400',
    blue: 'bg-blue-500/10 text-blue-400',
    purple: 'bg-purple-500/10 text-purple-400',
  };
  
  return (
    <div className="bg-slate-900 rounded-xl p-4 border border-slate-800">
      <div className="flex items-center justify-between mb-3">
        <span className="text-sm text-slate-400">{title}</span>
        <div className={`w-8 h-8 rounded-lg flex items-center justify-center ${colorClasses[color]}`}>
          <Icon className="w-4 h-4" />
        </div>
      </div>
      <p className="text-2xl font-bold">{value}</p>
      <div className="flex items-center gap-2 mt-1">
        <span className="text-xs text-green-400">{change}</span>
        <span className="text-xs text-slate-500">{period}</span>
      </div>
    </div>
  );
}

function PlatformCard({ name, status, lastSync, cards, spend }) {
  const platformColors = {
    EFS: 'blue',
    Commdata: 'green',
    Relay: 'purple',
  };
  const color = platformColors[name];
  
  return (
    <div className="bg-slate-900 rounded-xl p-4 border border-slate-800">
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center gap-3">
          <div className={`w-10 h-10 bg-${color}-500/20 rounded-lg flex items-center justify-center`}>
            <span className={`text-${color}-400 font-bold text-sm`}>{name.slice(0, 3).toUpperCase()}</span>
          </div>
          <div>
            <p className="font-medium">{name}</p>
            <p className="text-xs text-slate-500">Last sync: {lastSync}</p>
          </div>
        </div>
        <div className="flex items-center gap-1">
          <div className="w-2 h-2 bg-green-500 rounded-full" />
          <span className="text-xs text-green-400">Connected</span>
        </div>
      </div>
      <div className="grid grid-cols-2 gap-4">
        <div>
          <p className="text-xs text-slate-500">Active Cards</p>
          <p className="text-lg font-semibold">{cards}</p>
        </div>
        <div>
          <p className="text-xs text-slate-500">MTD Spend</p>
          <p className="text-lg font-semibold">{spend}</p>
        </div>
      </div>
    </div>
  );
}

function SpendBar({ label, amount, percent, color }) {
  return (
    <div>
      <div className="flex items-center justify-between text-sm mb-1">
        <span className="text-slate-400">{label}</span>
        <span className="font-medium">{amount}</span>
      </div>
      <div className="h-2 bg-slate-800 rounded-full overflow-hidden">
        <div className={`h-full ${color} rounded-full`} style={{ width: `${percent}%` }} />
      </div>
    </div>
  );
}

function TransactionRow({ driver, truck, location, gallons, pumpPrice, driverPrice, time, platform }) {
  return (
    <div className="px-4 py-3 flex items-center justify-between">
      <div className="flex items-center gap-4">
        <div className="w-10 h-10 bg-slate-800 rounded-full flex items-center justify-center">
          <UserCircle className="w-5 h-5 text-slate-500" />
        </div>
        <div>
          <p className="font-medium text-sm">{driver}</p>
          <p className="text-xs text-slate-500">{truck} • {location}</p>
        </div>
      </div>
      <div className="flex items-center gap-8 text-sm">
        <div className="text-right">
          <p className="font-medium">{gallons} gal</p>
          <p className="text-xs text-slate-500">{platform}</p>
        </div>
        <div className="text-right">
          <p className="text-slate-400 line-through text-xs">${pumpPrice.toFixed(2)}</p>
          <p className="font-medium text-green-400">${driverPrice.toFixed(2)}</p>
        </div>
        <div className="text-right w-20">
          <p className="font-medium">${(gallons * driverPrice).toFixed(2)}</p>
          <p className="text-xs text-slate-500">{time}</p>
        </div>
      </div>
    </div>
  );
}

function AlertRow({ type, message, time }) {
  const icons = {
    warning: AlertTriangle,
    info: Bell,
    success: CheckCircle,
  };
  const colors = {
    warning: 'text-amber-400 bg-amber-500/10',
    info: 'text-blue-400 bg-blue-500/10',
    success: 'text-green-400 bg-green-500/10',
  };
  const Icon = icons[type];
  
  return (
    <div className="flex items-start gap-3 p-3 bg-slate-800/50 rounded-lg">
      <div className={`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${colors[type]}`}>
        <Icon className="w-4 h-4" />
      </div>
      <div className="flex-1">
        <p className="text-sm">{message}</p>
        <p className="text-xs text-slate-500 mt-1">{time}</p>
      </div>
    </div>
  );
}

function DiscountTile({ network, fuelType, discount, locations }) {
  return (
    <div className="bg-slate-800/50 rounded-lg p-3">
      <div className="flex items-center justify-between mb-2">
        <span className="text-xs text-slate-500">{network}</span>
        <span className="text-xs bg-slate-700 px-2 py-0.5 rounded">{fuelType}</span>
      </div>
      <p className="text-lg font-bold text-green-400">{discount}</p>
      <p className="text-xs text-slate-500 mt-1">{locations}</p>
    </div>
  );
}

function WaterfallLevel({ level, title, subtitle, example, color, visibility, icon: Icon }) {
  const colorClasses = {
    red: 'border-red-500/30 bg-red-500/5',
    amber: 'border-amber-500/30 bg-amber-500/5',
    green: 'border-green-500/30 bg-green-500/5',
  };
  const textColors = {
    red: 'text-red-400',
    amber: 'text-amber-400',
    green: 'text-green-400',
  };
  
  return (
    <div className={`flex-1 rounded-lg border p-4 ${colorClasses[color]}`}>
      <div className="flex items-center gap-2 mb-2">
        <span className={`text-xs font-bold ${textColors[color]}`}>LEVEL {level}</span>
      </div>
      <h4 className="font-semibold">{title}</h4>
      <p className="text-xs text-slate-500 mt-1">{subtitle}</p>
      <p className={`text-lg font-bold mt-3 ${textColors[color]}`}>{example}</p>
      <div className="flex items-center gap-1 mt-2 text-xs text-slate-500">
        <Icon className="w-3 h-3" />
        <span>{visibility}</span>
      </div>
    </div>
  );
}

function PricingModelCard({ name, type, assignedTo, entities, isDefault, details }) {
  return (
    <div className="bg-slate-900 rounded-xl border border-slate-800 overflow-hidden">
      <div className="p-4 border-b border-slate-800">
        <div className="flex items-center justify-between mb-2">
          <h4 className="font-semibold">{name}</h4>
          {isDefault && <span className="text-xs bg-amber-500/20 text-amber-400 px-2 py-0.5 rounded">Default</span>}
        </div>
        <p className="text-xs text-slate-500">{assignedTo} • {entities} entities</p>
      </div>
      <div className="p-4 bg-slate-800/30">
        {details.map((detail, i) => (
          <div key={i} className="flex items-center justify-between py-1 text-sm">
            <span className="text-slate-400">{detail.tier || detail.label}</span>
            <span className="font-medium">{detail.rate || detail.value}</span>
            {detail.drivers && <span className="text-xs text-slate-500 ml-2">({detail.drivers})</span>}
          </div>
        ))}
      </div>
    </div>
  );
}

function ScoreTierCard({ tier, range, color, discount, count }) {
  const colors = {
    purple: 'bg-purple-500/20 border-purple-500/30 text-purple-400',
    amber: 'bg-amber-500/20 border-amber-500/30 text-amber-400',
    slate: 'bg-slate-500/20 border-slate-500/30 text-slate-400',
    orange: 'bg-orange-500/20 border-orange-500/30 text-orange-400',
  };
  
  return (
    <div className={`rounded-lg border p-3 text-center ${colors[color]}`}>
      <p className="font-bold">{tier}</p>
      <p className="text-xs opacity-70">{range}</p>
      <p className="text-lg font-bold mt-2">{count}</p>
      <p className="text-xs opacity-70">drivers</p>
    </div>
  );
}

function ScoreComponent({ name, weight, source }) {
  return (
    <div>
      <div className="flex items-center justify-between mb-1">
        <span className="text-sm font-medium">{name}</span>
        <span className="text-sm text-amber-400">{weight}%</span>
      </div>
      <p className="text-xs text-slate-500">{source}</p>
    </div>
  );
}

function CardStatusTile({ status, count, color }) {
  const colors = {
    green: 'bg-green-500/10 border-green-500/20 text-green-400',
    blue: 'bg-blue-500/10 border-blue-500/20 text-blue-400',
    amber: 'bg-amber-500/10 border-amber-500/20 text-amber-400',
    red: 'bg-red-500/10 border-red-500/20 text-red-400',
    purple: 'bg-purple-500/10 border-purple-500/20 text-purple-400',
  };
  
  return (
    <div className={`rounded-lg border p-4 ${colors[color]}`}>
      <p className="text-2xl font-bold">{count}</p>
      <p className="text-xs opacity-70">{status}</p>
    </div>
  );
}

function CardRow({ cardNumber, platform, entityName, entityType, status, pricingModel, dailyLimit, mtdSpend, expanded, onToggle }) {
  const statusColors = {
    Active: 'bg-green-500/20 text-green-400',
    Suspended: 'bg-amber-500/20 text-amber-400',
    Terminated: 'bg-red-500/20 text-red-400',
    Provisioned: 'bg-blue-500/20 text-blue-400',
  };
  const platformColors = {
    EFS: 'text-blue-400',
    Commdata: 'text-green-400',
    Relay: 'text-purple-400',
  };
  
  return (
    <>
      <tr className="hover:bg-slate-800/50 cursor-pointer" onClick={onToggle}>
        <td className="px-4 py-3">
          <p className="font-mono text-xs">{cardNumber}</p>
          <p className={`text-xs ${platformColors[platform]}`}>{platform}</p>
        </td>
        <td className="px-4 py-3">{entityName}</td>
        <td className="px-4 py-3 text-slate-400">{entityType}</td>
        <td className="px-4 py-3">
          <span className={`text-xs px-2 py-1 rounded ${statusColors[status]}`}>{status}</span>
        </td>
        <td className="px-4 py-3 text-slate-400">{pricingModel}</td>
        <td className="px-4 py-3">${dailyLimit}</td>
        <td className="px-4 py-3 font-medium">${mtdSpend.toLocaleString()}</td>
        <td className="px-4 py-3">
          <ChevronDown className={`w-4 h-4 text-slate-500 transition-transform ${expanded ? 'rotate-180' : ''}`} />
        </td>
      </tr>
      {expanded && (
        <tr>
          <td colSpan={8} className="bg-slate-800/30 px-4 py-4">
            <div className="grid grid-cols-4 gap-4">
              <div>
                <p className="text-xs text-slate-500 mb-1">Controls</p>
                <p className="text-sm">Daily: ${dailyLimit} • Trans: $300 • Gal: 150</p>
              </div>
              <div>
                <p className="text-xs text-slate-500 mb-1">Products</p>
                <p className="text-sm">Diesel, DEF, Reefer</p>
              </div>
              <div>
                <p className="text-xs text-slate-500 mb-1">Network</p>
                <p className="text-sm">In-Network Only</p>
              </div>
              <div className="flex items-center gap-2">
                <button className="px-3 py-1.5 bg-slate-700 rounded text-xs hover:bg-slate-600">Edit</button>
                <button className="px-3 py-1.5 bg-amber-500/20 text-amber-400 rounded text-xs hover:bg-amber-500/30">Suspend</button>
              </div>
            </div>
          </td>
        </tr>
      )}
    </>
  );
}

function ControlSetting({ label, value, adjustable, locked }) {
  return (
    <div className="flex items-center justify-between">
      <span className="text-sm text-slate-400">{label}</span>
      <div className="flex items-center gap-2">
        <span className="text-sm font-medium">{value}</span>
        {adjustable && <Edit2 className="w-3 h-3 text-slate-600" />}
        {locked && <span className="text-xs text-slate-600">🔒</span>}
      </div>
    </div>
  );
}

function ControlToggle({ label, enabled }) {
  return (
    <div className="flex items-center justify-between">
      <span className="text-sm text-slate-400">{label}</span>
      {enabled ? (
        <ToggleRight className="w-6 h-6 text-green-400" />
      ) : (
        <ToggleLeft className="w-6 h-6 text-slate-600" />
      )}
    </div>
  );
}

function FranchiseDriverRow({ name, truck, mtdGallons, mtdSpend, status }) {
  return (
    <div className="px-4 py-3 flex items-center justify-between">
      <div className="flex items-center gap-3">
        <div className="w-8 h-8 bg-slate-800 rounded-full flex items-center justify-center">
          <UserCircle className="w-4 h-4 text-slate-500" />
        </div>
        <div>
          <p className="font-medium text-sm">{name}</p>
          <p className="text-xs text-slate-500">{truck}</p>
        </div>
      </div>
      <div className="flex items-center gap-6 text-sm">
        <div className="text-right">
          <p className="font-medium">{mtdGallons} gal</p>
          <p className="text-xs text-slate-500">MTD</p>
        </div>
        <div className="text-right">
          <p className="font-medium">${mtdSpend.toLocaleString()}</p>
          <p className="text-xs text-slate-500">Billed</p>
        </div>
        <span className="text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded">{status}</span>
      </div>
    </div>
  );
}

function AlternativeStop({ name, distance, price, detour }) {
  return (
    <div className="bg-slate-800 rounded-lg p-3 flex items-center justify-between">
      <div>
        <p className="font-medium text-sm">{name}</p>
        <p className="text-xs text-slate-500">{distance} ahead • +{detour} detour</p>
      </div>
      <p className="font-bold">${price.toFixed(2)}</p>
    </div>
  );
}

function LimitBar({ label, used, limit }) {
  const percent = (used / limit) * 100;
  const color = percent > 80 ? 'bg-amber-500' : 'bg-green-500';
  
  return (
    <div>
      <div className="flex items-center justify-between text-xs mb-1">
        <span className="text-slate-400">{label}</span>
        <span>${used} / ${limit}</span>
      </div>
      <div className="h-2 bg-slate-700 rounded-full overflow-hidden">
        <div className={`h-full ${color} rounded-full`} style={{ width: `${percent}%` }} />
      </div>
    </div>
  );
}

function DriverTransaction({ location, city, gallons, amount, time, type }) {
  return (
    <div className="bg-slate-800 rounded-lg p-3">
      <div className="flex items-center justify-between mb-1">
        <p className="font-medium text-sm">{location}</p>
        <p className="font-bold">${amount.toFixed(2)}</p>
      </div>
      <div className="flex items-center justify-between text-xs text-slate-500">
        <span>{city} • {gallons} gal {type}</span>
        <span>{time}</span>
      </div>
    </div>
  );
}

function OptimizationStep({ step, title, description, icon: Icon }) {
  return (
    <div className="text-center">
      <div className="w-12 h-12 bg-amber-500/20 rounded-xl flex items-center justify-center mx-auto mb-3">
        <Icon className="w-6 h-6 text-amber-400" />
      </div>
      <div className="text-xs text-amber-400 mb-1">Step {step}</div>
      <p className="font-medium text-sm">{title}</p>
      <p className="text-xs text-slate-500 mt-1">{description}</p>
    </div>
  );
}

function FuelStopRecommendation({ rank, name, city, distance, price, savings, detour, status }) {
  const statusColors = {
    Primary: 'bg-green-500/20 text-green-400 border-green-500/30',
    Secondary: 'bg-slate-700 text-slate-300 border-slate-600',
  };
  
  return (
    <div className={`rounded-lg border p-4 ${statusColors[status]}`}>
      <div className="flex items-center justify-between mb-2">
        <div className="flex items-center gap-2">
          <span className="text-lg font-bold">#{rank}</span>
          <span className="font-medium">{name}</span>
        </div>
        <span className="text-lg font-bold">${price.toFixed(2)}/gal</span>
      </div>
      <div className="flex items-center gap-4 text-sm text-slate-400">
        <span>{city}</span>
        <span>{distance} mi ahead</span>
        <span>+{detour} min detour</span>
        <span className="text-green-400">Save ${savings.toFixed(2)}</span>
      </div>
    </div>
  );
}

function MarginRow({ entity, gallons, ourCost, billed, margin }) {
  return (
    <div className="flex items-center justify-between py-3 border-b border-slate-800">
      <div>
        <p className="font-medium">{entity}</p>
        <p className="text-xs text-slate-500">{gallons.toLocaleString()} gallons</p>
      </div>
      <div className="flex items-center gap-8 text-sm">
        <div className="text-right">
          <p className="text-slate-500">Our Cost</p>
          <p>${ourCost.toLocaleString()}</p>
        </div>
        <div className="text-right">
          <p className="text-slate-500">Billed</p>
          <p>${billed.toLocaleString()}</p>
        </div>
        <div className="text-right">
          <p className="text-slate-500">Margin</p>
          <p className="text-green-400 font-medium">${margin.toLocaleString()}</p>
        </div>
      </div>
    </div>
  );
}

function IFTARow({ state, diesel, def, reefer }) {
  const total = diesel + def + reefer;
  return (
    <tr>
      <td className="px-4 py-3 font-medium">{state}</td>
      <td className="px-4 py-3">{diesel.toLocaleString()}</td>
      <td className="px-4 py-3">{def.toLocaleString()}</td>
      <td className="px-4 py-3">{reefer.toLocaleString()}</td>
      <td className="px-4 py-3 font-medium">{total.toLocaleString()}</td>
    </tr>
  );
}

function FraudMetric({ label, count, trend, severity }) {
  const severityColors = {
    warning: 'bg-amber-500/10 text-amber-400',
    info: 'bg-blue-500/10 text-blue-400',
    success: 'bg-green-500/10 text-green-400',
  };
  
  return (
    <div className={`rounded-lg p-4 ${severityColors[severity]}`}>
      <p className="text-2xl font-bold">{count}</p>
      <p className="text-xs opacity-70 mt-1">{label}</p>
    </div>
  );
}

function FraudRow({ driver, issue, location, date, amount }) {
  return (
    <div className="px-4 py-3 flex items-center justify-between">
      <div>
        <p className="font-medium text-sm">{driver}</p>
        <p className="text-xs text-amber-400 mt-0.5">{issue}</p>
        <p className="text-xs text-slate-500 mt-0.5">{location}</p>
      </div>
      <div className="text-right">
        <p className="font-medium">${amount.toFixed(2)}</p>
        <p className="text-xs text-slate-500">{date}</p>
      </div>
    </div>
  );
}

function SettingRow({ label, description, value, type, editable, enabled, options }) {
  return (
    <div className="flex items-center justify-between py-2">
      <div>
        <p className="text-sm font-medium">{label}</p>
        <p className="text-xs text-slate-500">{description}</p>
      </div>
      {type === 'toggle' ? (
        enabled ? <ToggleRight className="w-8 h-8 text-green-400" /> : <ToggleLeft className="w-8 h-8 text-slate-600" />
      ) : type === 'select' ? (
        <select className="bg-slate-800 border border-slate-700 rounded px-3 py-1.5 text-sm">
          {options?.map((opt) => <option key={opt}>{opt}</option>)}
        </select>
      ) : (
        <div className="flex items-center gap-2">
          <span className="bg-slate-800 border border-slate-700 rounded px-3 py-1.5 text-sm">{value}</span>
          {editable && <Edit2 className="w-4 h-4 text-slate-600" />}
        </div>
      )}
    </div>
  );
}

// Render the app
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<FuelIntegrationWireframes />);
  </script>
</body>
</html>
